!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CitrixWebRTC=t():t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.tracing=!1,this.mslogger_=void 0,this.tag=e,this.enabled=!0}return e.prototype.setMSLogger=function(e){this.mslogger_=e},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(null!=this.mslogger_?this.mslogger_.info(this.tag+" "+e):console.log(this.tag+" "+e))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracing&&this.log.apply(this,e)},e}();t.Logger=i,t.logger=new i("[HdxWebRTC.js]"),t.logger.enabled=!0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HDXMS_VERSION="1.6.0.1";var i=function(e,t,n,i){this.major=e,this.minor=t,this.revision=n,this.build=i};t.VersionData=i;var r=function(){};t.FeatureData=r;var o=function(e,t){this.fature=e,this.version=t},a=function(e,t,n,i,r){this.family=e,this.version=t,this.architecture=n,this.distro=i,this.edition=r};t.OSInfo=a,t.FEATURE_ms_teams_redirection="ms_teams_redirection",t.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing",t.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator",t.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints",t.FEATURE_ms_teams_1911="ms_teams_1911",t.FEATURE_ms_teams_pstn="ms_teams_pstn",t.FEATURE_ms_teams_1912="ms_teams_1912",t.FEATURE_ms_teams_mstrack_constraints="ms_teams_mstrack_constraints",t.FEATURE_ms_teams_osinfo="ms_teams_osinfo";var s,c,d,l,u,_,g,h,f,p,m,y,v,C,T,b,R,S,w,k,E,I;new o(t.FEATURE_ms_teams_redirection,new i(1,1,0,0)),new o(t.FEATURE_ms_teams_desktop_sharing,new i(1,2,0,0)),new o(t.FEATURE_ms_teams_speaking_indicator,new i(1,2,0,0)),new o(t.FEATURE_ms_teams_common_media_constraints,new i(1,4,0,0)),new o(t.FEATURE_ms_teams_1911,new i(1,4,0,0)),new o(t.FEATURE_ms_teams_1912,new i(1,5,0,0)),new o(t.FEATURE_ms_teams_mstrack_constraints,new i(1,6,0,0)),new o(t.FEATURE_ms_teams_pstn,new i(1,6,0,0)),new o(t.FEATURE_ms_teams_osinfo,new i(1,7,0,0));t.FEATURE_public_screenshare="screenshare",t.FEATURE_public_redirection="redirection",t.FEATURE_public_speaking_indicator="speaking_indicator",t.FEATURE_public_pstn="pstn",t.FEATURE_public_osinfo="osinfo",t.featureNameMap={},t.featureNameMap[t.FEATURE_public_screenshare]=[t.FEATURE_ms_teams_desktop_sharing],t.featureNameMap[t.FEATURE_public_redirection]=[t.FEATURE_ms_teams_redirection],t.featureNameMap[t.FEATURE_public_speaking_indicator]=[t.FEATURE_ms_teams_speaking_indicator],t.featureNameMap[t.FEATURE_public_pstn]=[t.FEATURE_ms_teams_pstn],t.featureNameMap[t.FEATURE_public_osinfo]=[t.FEATURE_ms_teams_osinfo],function(e){e[e.EngineControl=0]="EngineControl",e[e.RTCPeerConnection=1]="RTCPeerConnection",e[e.RTCSessionDescription=2]="RTCSessionDescription",e[e.RTCIceCandidate=3]="RTCIceCandidate",e[e.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",e[e.MediaDevices=5]="MediaDevices",e[e.MediaDeviceInfo=6]="MediaDeviceInfo",e[e.MediaStreamTrack=7]="MediaStreamTrack",e[e.MediaStreamEvent=8]="MediaStreamEvent",e[e.MediaStream=9]="MediaStream",e[e.NavigatorUserMedia=10]="NavigatorUserMedia",e[e.VideoElement=11]="VideoElement",e[e.AudioElement=12]="AudioElement",e[e.RTCRtpReceiver=13]="RTCRtpReceiver",e[e.RTCRtpSender=14]="RTCRtpSender",e[e.RTCDtlsTransport=15]="RTCDtlsTransport",e[e.RTCIceTransport=16]="RTCIceTransport",e[e.RTCDTMFSender=17]="RTCDTMFSender",e[e.RTCDTMFToneChangeEvent=18]="RTCDTMFToneChangeEvent",e[e.RTCIceCandidatePair=19]="RTCIceCandidatePair",e[e.RTCRtpTransceiver=20]="RTCRtpTransceiver"}(s=t.class_id_t||(t.class_id_t={})),function(e){e[e.ctor=0]="ctor",e[e.version=1]="version",e[e.feature_flags=2]="feature_flags",e[e.version_info=3]="version_info",e[e.osinfo=4]="osinfo"}(c=t.method_id_EngineControl_t||(t.method_id_EngineControl_t={})),function(e){e[e.ctor=0]="ctor",e[e.localDescription=1]="localDescription",e[e.remoteDescription=2]="remoteDescription",e[e.readyState=3]="readyState",e[e.iceState=4]="iceState",e[e.localStreams=5]="localStreams",e[e.remoteStreams=6]="remoteStreams",e[e.createOffer=7]="createOffer",e[e.createAnswer=8]="createAnswer",e[e.setLocalDescription=9]="setLocalDescription",e[e.setRemoteDescription=10]="setRemoteDescription",e[e.updateIce=11]="updateIce",e[e.addIceCandidate=12]="addIceCandidate",e[e.addStream=13]="addStream",e[e.removeStream=14]="removeStream",e[e.close=15]="close",e[e.iceConnectionState=16]="iceConnectionState",e[e.iceGatheringState=17]="iceGatheringState",e[e.signalingState=18]="signalingState",e[e.onaddstream=19]="onaddstream",e[e.onicecandidate=20]="onicecandidate",e[e.oniceconnectionstatechange=21]="oniceconnectionstatechange",e[e.onicegatheringstatechange=22]="onicegatheringstatechange",e[e.onsignalingstatechange=23]="onsignalingstatechange",e[e.onnegotiationneeded=24]="onnegotiationneeded",e[e.onremovestream=25]="onremovestream",e[e.getStats=26]="getStats",e[e.getReceivers=27]="getReceivers",e[e.getSenders=28]="getSenders",e[e.addTrack=29]="addTrack",e[e.removeTrack=30]="removeTrack",e[e.ontrack=31]="ontrack"}(d=t.method_id_RTCPeerConnection_t||(t.method_id_RTCPeerConnection_t={})),function(e){e[e.ctor=0]="ctor",e[e.enumerateDevices=1]="enumerateDevices",e[e.getDisplayMedia=2]="getDisplayMedia",e[e.ondevicechange=3]="ondevicechange"}(l=t.method_id_MediaDevices_t||(t.method_id_MediaDevices_t={})),function(e){e[e.ctor=0]="ctor",e[e.deviceId=1]="deviceId",e[e.kind=2]="kind",e[e.label=3]="label",e[e.groupId=4]="groupId"}(u=t.method_id_MediaDeviceInfo_t||(t.method_id_MediaDeviceInfo_t={})),function(e){e[e.ctor=0]="ctor",e[e.type=1]="type",e[e.sdp=2]="sdp"}(_=t.method_id_RTCSessionDescription_t||(t.method_id_RTCSessionDescription_t={})),function(e){e[e.ctor=0]="ctor",e[e.kind=1]="kind",e[e.id=2]="id",e[e.label=3]="label",e[e.enabled=4]="enabled",e[e.muted=5]="muted",e[e.readyState=6]="readyState",e[e.onended=7]="onended",e[e.onmute=8]="onmute",e[e.onunmute=9]="onunmute",e[e.clone=10]="clone",e[e.stop=11]="stop",e[e.getCapabilities=12]="getCapabilities",e[e.getSettings=13]="getSettings",e[e.applyConstraints=14]="applyConstraints",e[e.getConstraints=15]="getConstraints"}(g=t.method_id_MediaStreamTrack_t||(t.method_id_MediaStreamTrack_t={})),function(e){e[e.ctor=0]="ctor",e[e.id=1]="id",e[e.getAudioTracks=2]="getAudioTracks",e[e.getVideoTracks=3]="getVideoTracks",e[e.getTracks=4]="getTracks",e[e.getTrackById=5]="getTrackById",e[e.addTrack=6]="addTrack",e[e.removeTrack=7]="removeTrack",e[e.clone=8]="clone",e[e.active=9]="active"}(h=t.method_id_MediaStream_t||(t.method_id_MediaStream_t={})),function(e){e[e.ctor=0]="ctor",e[e.getUserMedia=1]="getUserMedia"}(f=t.method_id_NavigatorUserMedia_t||(t.method_id_NavigatorUserMedia_t={})),function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate",e[e.sdpMid=2]="sdpMid",e[e.sdpMLineIndex=3]="sdpMLineIndex"}(p=t.method_id_RTCIceCandidate_t||(t.method_id_RTCIceCandidate_t={})),function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate"}(m=t.method_id_RTCIceCandidateEvent_t||(t.method_id_RTCIceCandidateEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.stream=1]="stream"}(y=t.method_id_MediaStreamEvent_t||(t.method_id_MediaStreamEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.connectTo=2]="connectTo",e[e.disconnect=3]="disconnect",e[e.setFrame=4]="setFrame",e[e.addClipRect=5]="addClipRect",e[e.removeClipRect=6]="removeClipRect",e[e.onerror=7]="onerror",e[e.onvideoframechanged=8]="onvideoframechanged"}(v=t.method_id_VideoElement_t||(t.method_id_VideoElement_t={})),function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.srcObject=2]="srcObject",e[e.src=3]="src",e[e.play=4]="play",e[e.pause=5]="pause"}(C=t.method_id_AudioElement_t||(t.method_id_AudioElement_t={})),function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.getContributingSources=2]="getContributingSources",e[e.getSynchronizationSources=3]="getSynchronizationSources",e[e.transport=4]="transport",e[e.rtcpTransport=5]="rtcpTransport",e[e.getCapabilities=6]="getCapabilities",e[e.getParameters=7]="getParameters",e[e.getStats=8]="getStats"}(T=t.method_id_RTCRtpReceiver_t||(t.method_id_RTCRtpReceiver_t={})),function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.transport=2]="transport",e[e.rtcpTransport=3]="rtcpTransport",e[e.dtmf=4]="dtmf",e[e.getCapabilities=5]="getCapabilities",e[e.getParameters=6]="getParameters",e[e.setParameters=7]="setParameters",e[e.replaceTrack=8]="replaceTrack",e[e.getStats=9]="getStats",e[e.setStreams=10]="setStreams"}(b=t.method_id_RTCRtpSender_t||(t.method_id_RTCRtpSender_t={})),function(e){e[e.ctor=0]="ctor",e[e.transport=1]="transport",e[e.state=2]="state",e[e.getRemoteCertificates=3]="getRemoteCertificates",e[e.onstatechange=4]="onstatechange",e[e.onerror=5]="onerror"}(R=t.method_id_RTCDtlsTransport_t||(t.method_id_RTCDtlsTransport_t={})),function(e){e[e.ctor=0]="ctor",e[e.role=1]="role",e[e.component=2]="component",e[e.state=3]="state",e[e.gatheringState=4]="gatheringState",e[e.localcandidates=5]="localcandidates",e[e.remotecandidates=6]="remotecandidates",e[e.onstatechange=7]="onstatechange",e[e.ongatheringstatechange=8]="ongatheringstatechange",e[e.onselectedcandidatepairchange=9]="onselectedcandidatepairchange"}(S=t.method_id_RTCIceTransport_t||(t.method_id_RTCIceTransport_t={})),function(e){e[e.ctor=0]="ctor",e[e.insertDTMF=1]="insertDTMF",e[e.ontonechange=2]="ontonechange",e[e.canInsertDTMF=3]="canInsertDTMF",e[e.toneBuffer=4]="toneBuffer"}(w=t.method_id_RTCDTMFSender_t||(t.method_id_RTCDTMFSender_t={})),function(e){e[e.ctor=0]="ctor",e[e.tone=1]="tone",e[e.tone_buffer=2]="tone_buffer"}(k=t.method_id_RTCDTMFToneChangeEvent_t||(t.method_id_RTCDTMFToneChangeEvent_t={})),function(e){e[e.ctor=0]="ctor",e[e.local=1]="local",e[e.remote=2]="remote"}(E=t.method_id_RTCIceCandidatePair_t||(t.method_id_RTCIceCandidatePair_t={})),function(e){e[e.ctor=0]="ctor",e[e.mid=1]="mid",e[e.sender=2]="sender",e[e.receiver=3]="receiver",e[e.direction=4]="direction",e[e.currentDirection=5]="currentDirection",e[e.stop=6]="stop",e[e.setCodecPreferences=7]="setCodecPreferences"}(I=t.method_id_RTCRtpTransceiver_t||(t.method_id_RTCRtpTransceiver_t={}));var P=function(e,n,i,r,o){void 0===o&&(o=t.FEATURE_ms_teams_redirection),this.iid=e,this.mid=n,this.name=i,this.isprop=r,this.feature=o};t.WebrpcMethodInfo=P;var D=function(e,t,n){this.id=e,this.name=t,this.methods=n};t.WebrpcClassInfo=D;var M=new function(e,t){this.name=e,this.classes=t}("msteams_class_library",[new D(s.EngineControl,"EngineControl",[new P(s.EngineControl,c.ctor,"ctor",!1),new P(s.EngineControl,c.version,"version",!0),new P(s.EngineControl,c.feature_flags,"feature_flags",!0),new P(s.EngineControl,c.version_info,"version_info",!0,t.FEATURE_ms_teams_desktop_sharing),new P(s.EngineControl,c.osinfo,"osinfo",!0,t.FEATURE_ms_teams_osinfo)]),new D(s.RTCPeerConnection,"RTCPeerConnection",[new P(s.RTCPeerConnection,d.ctor,"ctor",!1),new P(s.RTCPeerConnection,d.localDescription,"localDescription",!0),new P(s.RTCPeerConnection,d.remoteDescription,"remoteDescription",!0),new P(s.RTCPeerConnection,d.readyState,"readyState",!0),new P(s.RTCPeerConnection,d.iceState,"iceState",!0),new P(s.RTCPeerConnection,d.localStreams,"localStreams",!0),new P(s.RTCPeerConnection,d.remoteStreams,"remoteStreams",!0),new P(s.RTCPeerConnection,d.createOffer,"createOffer",!1),new P(s.RTCPeerConnection,d.createAnswer,"createAnswer",!1),new P(s.RTCPeerConnection,d.setLocalDescription,"setLocalDescription",!1),new P(s.RTCPeerConnection,d.setRemoteDescription,"setRemoteDescription",!1),new P(s.RTCPeerConnection,d.updateIce,"updateIce",!0),new P(s.RTCPeerConnection,d.addIceCandidate,"addIceCandidate",!0),new P(s.RTCPeerConnection,d.addStream,"addStream",!0),new P(s.RTCPeerConnection,d.removeStream,"removeStream",!0),new P(s.RTCPeerConnection,d.close,"close",!0),new P(s.RTCPeerConnection,d.iceConnectionState,"iceConnectionState",!0),new P(s.RTCPeerConnection,d.iceGatheringState,"iceGatheringState",!0),new P(s.RTCPeerConnection,d.signalingState,"signalingState",!0),new P(s.RTCPeerConnection,d.onaddstream,"onaddstream",!0),new P(s.RTCPeerConnection,d.onicecandidate,"onicecandidate",!0),new P(s.RTCPeerConnection,d.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new P(s.RTCPeerConnection,d.onicegatheringstatechange,"onicegatheringstatechange",!0),new P(s.RTCPeerConnection,d.onsignalingstatechange,"onsignalingstatechange",!0),new P(s.RTCPeerConnection,d.onnegotiationneeded,"onnegotiationneeded",!0),new P(s.RTCPeerConnection,d.onremovestream,"onremovestream",!0),new P(s.RTCPeerConnection,d.getStats,"getStats",!1),new P(s.RTCPeerConnection,d.getReceivers,"getReceivers",!1,t.FEATURE_ms_teams_speaking_indicator),new P(s.RTCPeerConnection,d.getSenders,"getSenders",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCPeerConnection,d.addTrack,"addTrack",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCPeerConnection,d.removeTrack,"removeTrack",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCPeerConnection,d.ontrack,"ontrack",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCSessionDescription,"RTCSessionDescription",[new P(s.RTCSessionDescription,_.ctor,"ctor",!1),new P(s.RTCSessionDescription,_.type,"type",!0),new P(s.RTCSessionDescription,_.sdp,"sdp",!0)]),new D(s.RTCIceCandidate,"RTCIceCandidate",[new P(s.RTCIceCandidate,p.ctor,"ctor",!1),new P(s.RTCIceCandidate,p.candidate,"candidate",!0),new P(s.RTCIceCandidate,p.sdpMid,"sdpMid",!0),new P(s.RTCIceCandidate,p.sdpMLineIndex,"sdpMLineIndex",!0)]),new D(s.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new P(s.RTCIceCandidateEvent,m.ctor,"ctor",!1),new P(s.RTCIceCandidateEvent,m.candidate,"candidate",!0)]),new D(s.MediaDevices,"MediaDevices",[new P(s.MediaDevices,l.ctor,"ctor",!1),new P(s.MediaDevices,l.enumerateDevices,"enumerateDevices",!1),new P(s.MediaDevices,l.getDisplayMedia,"getDisplayMedia",!1,t.FEATURE_ms_teams_desktop_sharing),new P(s.MediaDevices,l.ondevicechange,"ondevicechange",!0,t.FEATURE_ms_teams_speaking_indicator)]),new D(s.MediaDeviceInfo,"MediaDeviceInfo",[new P(s.MediaDeviceInfo,u.ctor,"ctor",!1),new P(s.MediaDeviceInfo,u.deviceId,"deviceId",!0),new P(s.MediaDeviceInfo,u.kind,"kind",!0),new P(s.MediaDeviceInfo,u.label,"label",!0),new P(s.MediaDeviceInfo,u.groupId,"groupId",!0)]),new D(s.MediaStreamTrack,"MediaStreamTrack",[new P(s.MediaStreamTrack,g.ctor,"ctor",!1),new P(s.MediaStreamTrack,g.clone,"clone",!1),new P(s.MediaStreamTrack,g.stop,"stop",!1),new P(s.MediaStreamTrack,g.getCapabilities,"getCapabilities",!1),new P(s.MediaStreamTrack,g.getSettings,"getSettings",!1),new P(s.MediaStreamTrack,g.applyConstraints,"applyConstraints",!1,t.FEATURE_ms_teams_desktop_sharing),new P(s.MediaStreamTrack,g.kind,"kind",!0),new P(s.MediaStreamTrack,g.id,"id",!0),new P(s.MediaStreamTrack,g.label,"label",!0),new P(s.MediaStreamTrack,g.enabled,"enabled",!0),new P(s.MediaStreamTrack,g.muted,"muted",!0),new P(s.MediaStreamTrack,g.readyState,"readyState",!0),new P(s.MediaStreamTrack,g.onended,"onended",!0),new P(s.MediaStreamTrack,g.onmute,"onmute",!0),new P(s.MediaStreamTrack,g.onunmute,"onunmute",!0),new P(s.MediaStreamTrack,g.getConstraints,"getConstraints",!1,t.FEATURE_ms_teams_mstrack_constraints)]),new D(s.MediaStream,"MediaStream",[new P(s.MediaStream,h.ctor,"ctor",!1),new P(s.MediaStream,h.id,"id",!0),new P(s.MediaStream,h.getAudioTracks,"getAudioTracks",!1),new P(s.MediaStream,h.getVideoTracks,"getVideoTracks",!1),new P(s.MediaStream,h.getTracks,"getTracks",!1),new P(s.MediaStream,h.getTrackById,"getTrackById",!1),new P(s.MediaStream,h.addTrack,"addTrack",!1),new P(s.MediaStream,h.removeTrack,"removeTrack",!1),new P(s.MediaStream,h.clone,"clone",!0),new P(s.MediaStream,h.active,"active",!0)]),new D(s.NavigatorUserMedia,"NavigatorUserMedia",[new P(s.NavigatorUserMedia,f.ctor,"ctor",!1),new P(s.NavigatorUserMedia,f.getUserMedia,"getUserMedia",!1)]),new D(s.MediaStreamEvent,"MediaStreamEvent",[new P(s.MediaStreamEvent,y.ctor,"ctor",!1),new P(s.MediaStreamEvent,y.stream,"stream",!0)]),new D(s.VideoElement,"VideoElement",[new P(s.VideoElement,v.ctor,"ctor",!1),new P(s.VideoElement,v.sinkId,"sinkId",!0),new P(s.VideoElement,v.connectTo,"connectTo",!1),new P(s.VideoElement,v.disconnect,"disconnect",!1),new P(s.VideoElement,v.setFrame,"setFrame",!1),new P(s.VideoElement,v.addClipRect,"addClipRect",!1),new P(s.VideoElement,v.removeClipRect,"removeClipRect",!1),new P(s.VideoElement,v.onerror,"onerror",!0),new P(s.VideoElement,v.onvideoframechanged,"onvideoframechanged",!0)]),new D(s.AudioElement,"AudioElement",[new P(s.AudioElement,C.ctor,"ctor",!1),new P(s.AudioElement,C.sinkId,"sinkId",!0),new P(s.AudioElement,C.srcObject,"srcObject",!0),new P(s.AudioElement,C.src,"src",!0),new P(s.AudioElement,C.play,"play",!1),new P(s.AudioElement,C.pause,"pause",!1)]),new D(s.RTCRtpReceiver,"RTCRtpReceiver",[new P(s.RTCRtpReceiver,T.ctor,"ctor",!1,t.FEATURE_ms_teams_speaking_indicator),new P(s.RTCRtpReceiver,T.track,"track",!0,t.FEATURE_ms_teams_speaking_indicator),new P(s.RTCRtpReceiver,T.getContributingSources,"getContributingSources",!1,t.FEATURE_ms_teams_speaking_indicator),new P(s.RTCRtpReceiver,T.getSynchronizationSources,"getSynchronizationSources",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpReceiver,T.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpReceiver,T.rtcpTransport,"rtcptransport",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpReceiver,T.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpReceiver,T.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpReceiver,T.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn)]),new D(s.RTCRtpSender,"RTCRtpSender",[new P(s.RTCRtpSender,b.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.track,"track",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.rtcpTransport,"rtcpTransport",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.dtmf,"dtmf",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.getCapabilities,"getCapabilities",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.getParameters,"getParameters",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.setParameters,"setParameters",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.replaceTrack,"replaceTrack",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.getStats,"getStats",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpSender,b.setStreams,"setStreams",!1,t.FEATURE_ms_teams_pstn)]),new D(s.RTCDtlsTransport,"RTCDtlsTransport",[new P(s.RTCDtlsTransport,R.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCDtlsTransport,R.transport,"transport",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDtlsTransport,R.state,"state",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDtlsTransport,R.getRemoteCertificates,"getRemoteCertificates",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCDtlsTransport,R.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDtlsTransport,R.onerror,"onerror",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCIceTransport,"RTCIceTransport",[new P(s.RTCIceTransport,S.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.role,"role",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.component,"component",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.state,"state",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.gatheringState,"gatheringState",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.localcandidates,"localcandidates",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.remotecandidates,"remotecandidates",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.onstatechange,"onstatechange",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.ongatheringstatechange,"ongatheringstatechange",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceTransport,S.onselectedcandidatepairchange,"onselectedcandidatepairchange",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCDTMFSender,"RTCDTMFSender",[new P(s.RTCDTMFSender,w.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFSender,w.insertDTMF,"insertDTMF",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFSender,w.ontonechange,"ontonechange",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFSender,w.canInsertDTMF,"canInsertDTMF",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFSender,w.toneBuffer,"toneBuffer",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCDTMFToneChangeEvent,"RTCDTMFToneChangeEvent",[new P(s.RTCDTMFToneChangeEvent,k.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFToneChangeEvent,k.tone,"tone",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCDTMFToneChangeEvent,k.tone_buffer,"tone_buffer",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCIceCandidatePair,"RTCIceCandidatePair",[new P(s.RTCIceCandidatePair,E.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCIceCandidatePair,E.local,"local",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCIceCandidatePair,E.remote,"remote",!0,t.FEATURE_ms_teams_pstn)]),new D(s.RTCRtpTransceiver,"RTCRtpTransceiver",[new P(s.RTCRtpTransceiver,I.ctor,"ctor",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.mid,"mid",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.sender,"sender",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.receiver,"receiver",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.direction,"direction",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.currentDirection,"currentDirection",!0,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.stop,"stop",!1,t.FEATURE_ms_teams_pstn),new P(s.RTCRtpTransceiver,I.setCodecPreferences,"setCodecPreferences",!1,t.FEATURE_ms_teams_pstn)])]),O=function(){function e(){}return e.getInterfaceByid=function(e){for(var t=0,n=M.classes;t<n.length;t++){var i=n[t];if(i.id==e)return i}return null},e.getMethodByid=function(e,t){var n=this.getInterfaceByid(e);if(null!=n)for(var i=0,r=n.methods;i<r.length;i++){var o=r[i];if(o.mid==t)return o}return null},e.getMethodFeatureByid=function(e,t){var n=this.getInterfaceByid(e);if(null!=n)for(var i=0,r=n.methods;i<r.length;i++){var o=r[i];if(o.mid==t)return o.feature}return null},e.composeClassInfoData=function(e){var t=e.hdr;if(null==t)return"*** Invalid packet: Couldn't find hdr object ***";var n=t.proc;if(null==n)return"";for(var i=n.iid,r=n.methodid,o=0,a=M.classes;o<a.length;o++){var s=a[o];if(s.id==i)for(var c=0,d=s.methods;c<d.length;c++){var l=d[c];if(l.mid==r)return s.name+"::"+l.name}}return""},e}();t.WebrpcClassLibInfoUtil=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),o=n(0),a=n(1),s=n(6),c=n(4),d=function(e,t,n,i,r,o,a){this.resolve=e,this.reject=t,this.iid=n,this.oid=i,this.cbid=r,this.oneShot=o,this.mid=a};!function(e){e[e.NotRedirected=0]="NotRedirected",e[e.Connecting=1]="Connecting",e[e.Binding=2]="Binding",e[e.Redirected=3]="Redirected"}(i=t.RedirectionStatus||(t.RedirectionStatus={}));var l=function(){function e(){this.pingactive=!1,this.status=i.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=new Array,this.telemetry_=new c.Telemetry,this.stateChangeNotifcations=[]}return Object.defineProperty(e.prototype,"telemetry",{get:function(){return this.telemetry_},enumerable:!0,configurable:!0}),e.prototype.setRemoteSessionInfoCb=function(e){this.remoteSessionInfoCb=e},e.prototype.setFeatures=function(e){this.features=e},e.prototype.getFeatureValue=function(e){var t=this.features.find((function(t){return t.name===e}));return void 0!==t&&t.value},e.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&this.deferredActions.length>0;)this.deferredActions.shift().post(this.status==i.Redirected)},e.prototype.connectToService=function(){return o.logger.log("Redirection status: Connecting..."),this.status=i.Connecting,new Promise((function(e,t){var n=new WebSocket("wss://127.0.0.1:9002");n.onopen=function(){e(n)},n.onerror=function(e){o.logger.log("websocket connection error: "+e.type),t(e)}}))},e.prototype.waitUntilRedirected=function(e){var t=this;return new Promise((function(n,r){t.status==i.Redirected?n():e<=0?r():setTimeout((function(){o.logger.log("waitUntilRedirected() timeout. count="+e),t.status!=i.Redirected?t.waitUntilRedirected(--e).then((function(){n()})).catch((function(){r()})):n()}),2e3)}))},e.prototype.handleRemoteSessionInfo=function(){var e=this;o.logger.log("handleRemoteSessionInfo called.");var t=this;t.remoteSessionInfoCb?t.remoteSessionInfoCb().then((function(n){o.logger.log("remoteSessionInfo success! info:"+JSON.stringify(n)),o.logger.log("Redirection status: Redirected"),t.status=i.Redirected,t.pingConnectionEnd(),(0,window.onVdiClientConnected)(),e.telemetry.SendTelemetryInit(),t.onRedirectionComplete()})).catch((function(){o.logger.log("remoteSessionInfo failure!"),t.suspendRedirection(!0),t.onRedirectionComplete()})):(o.logger.log("remoteSessionInfoCb is invalid!"),t.suspendRedirection(!0),t.onRedirectionComplete())},e.prototype.startRedirection=function(e,t){var n=this,a=window.onVdiClientDisconnected;return new Promise((function(s,c){n.status!=i.Redirected?(o.logger.log("Attempting to start redirection: "+t),!1===e?n.deferredActions.push(new r.deferred_action(s,c,t)):n.connectToService().then((function(e){o.logger.log("Redirection status: Binding..."),n.status=i.Binding,n.websocket=e,n.websocket.onmessage=function(e){n.onWSMessage(e)},n.websocket.onclose=function(e){n.onWSClose(e)},s(),n.handleRemoteSessionInfo()})).catch((function(e){o.logger.log("Unable to connect to websocket service!"),c(),n.suspendRedirection(!0),n.onRedirectionComplete(),a(!0)}))):(o.logger.log("Redirection already started."),s())}))},e.prototype.suspendRedirection=function(e){var t=this;o.logger.log("Suspending redirection."),(0,window.onVdiClientDisconnected)(!1);var n=!1;(0,window.getCitrixMSTeamsRedir)().then((function(e){o.logger.log("sucesss on disconnect"+e),1==e&&""!==e&&(n=!0,o.logger.log("Reg key exists while disconnecting")),t.status===i.Redirected&&1==n&&(o.logger.log("Calling ping not normal disconnect"),t.pingConnectionBegin(!1)),o.logger.log("Redirection status: NotRedirected"),t.status=i.NotRedirected})),this.dispatchStateChangeNotifications()},e.prototype.onWSOpen=function(){},e.prototype.onWSClose=function(e){o.logger.log("disconnected from websocket service.");try{this.suspendRedirection(!0)}catch(e){o.logger.log("suspendRedirection(): exception closing WebSocket: "+e.message)}},e.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(e){o.logger.log("suspendRedirection(): exception on WebSocket error: "+e.message)}},e.prototype.WSSendObjectWrapper=function(e,t,n,i){var r=!0;t!=a.class_id_t.EngineControl||n!=a.method_id_EngineControl_t.ctor&&n!=a.method_id_EngineControl_t.version&&n!=a.method_id_EngineControl_t.feature_flags||(r=!1);var o=!0;if(r&&(o=!1,null!=this.features))for(var s=0,c=this.features;s<c.length;s++){var d=c[s];if(!0===d.value&&d.name==e){o=!0;break}}return 1==o?this.WSSendObject(i):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+t+") mid("+n+")")},e.prototype.WSSendObject=function(e){var t=this;return new Promise((function(n,i){if("webrtc"==e.v){var r=e.hdr.proc.iid,s=e.hdr.proc.methodid,c=e.objref.oid;if(!e.hdr.destroy){var l=new d(n,i,r,c,0,!0,s);t.reqs.push(l)}var u=JSON.stringify(e);o.logger.trace("WSSendObject: >>> "+a.WebrpcClassLibInfoUtil.composeClassInfoData(e)+" "+u);try{t.websocket.send(u)}catch(e){o.logger.log("WSSendObject(): exception: "+e.message),i(e.message)}}else if("overlay"==e.v){u=JSON.stringify(e);o.logger.log("HDXMS: SendOverlayData: >>> "+u+"'"),t.websocket.send(u)}else if("telemetry"==e.v){u=JSON.stringify(e);o.logger.log("HDXMS: SendTelemetryData: >>> "+u+"'"),t.websocket.send(u)}else o.logger.log("HDXMS: Unknown protocol: '"+JSON.stringify(e)+"'")}))},e.prototype.onWSMessage=function(e){var t,n=e.data;try{t=JSON.parse(n)}catch(e){console.log("invalid JSON!!!"),console.log(e),console.log(n)}if("webrtc"==t.v){o.logger.trace("onWSMessage: <<< "+a.WebrpcClassLibInfoUtil.composeClassInfoData(t)+" "+n);var i=t.hdr.proc.iid,r=t.hdr.proc.methodid,c=t.objref.oid,d=t.status;if(t.hdr.msg_type==s.WsJsonUtil.getMsgType(s.ws_msg_type_t.reply))(l=this.reqs.findIndex((function(e){return e.iid==i&&e.oid==c&&e.mid==r})))>=0?0==d?this.reqs.splice(l,1).shift().resolve(t):this.reqs.splice(l,1).shift().reject():(o.logger.log("HDXMS didnt find this one. (reqs)"),o.logger.log(this.reqs));else if(t.hdr.msg_type==s.WsJsonUtil.getMsgType(s.ws_msg_type_t.event_req)){var l,u=t.func.id;(l=this.cbs.findIndex((function(e){return e.iid==i&&e.oid==c&&e.cbid==u>>16})))>=0?(0==(65535&u)?this.cbs[l].resolve(t):this.cbs[l].reject(t),1==this.cbs[l].oneShot&&this.cbs.splice(l,1)):(o.logger.log("HDXMS didnt find this one. (cbs)"),o.logger.log(this.cbs))}else o.logger.log("HDXMS Received bogus message: "+n+"'")}else if("telemetry"==t.v){if(0==t.status)if(2==(2147483647&t.hdr.command)){var _=t.hdr.id;this.telemetry.onInitialized(_),o.logger.log("Telemetry init response received")}}else o.logger.log("HDXMS: Unknown protocol: "+n+"'")},e.prototype.registerHandler=function(e,t,n){var i=new d(n.resolve.bind(n),n.reject.bind(n),e,t,n.id,n.oneShot,0);this.cbs.push(i)},e.prototype.unregisterHandler=function(e,t,n){var i=this.cbs.findIndex((function(i){return i.iid==e&&i.oid==t&&i.cbid==n}));i>=0?this.cbs.splice(i,1):(o.logger.log("HDXMS Didnt find this callback in the list!"),console.log(this.cbs))},e.prototype.isRedirected=function(){return this.status===i.Redirected||this.status===i.Binding||this.status===i.Connecting},e.prototype.isPingActive=function(){return this.pingactive},e.prototype.pingConnectionBegin=function(e){o.logger.log("Started timer"),this.pingactive=!0;var t=window.onVdiClientDisconnectedTimer;1==e?(o.logger.log("checking if we are connected..."),t()):this.conntimer=setTimeout((function(){o.logger.log("checking if we are connected..."),t()}),15e3)},e.prototype.pingConnectionEnd=function(){this.pingactive=!1,clearTimeout(this.conntimer)},e.prototype.SendTelemetryData_Speaker=function(e){this.telemetry.SendTelemetryData(c.tel_cmd.Data,c.tel_key_SpeakerDeviceUsed,e,0)},e.prototype.registerStateChangeNotification=function(e){this.stateChangeNotifcations.push(e)},e.prototype.unregisterStateChangeNotification=function(e){this.stateChangeNotifcations=this.stateChangeNotifcations.filter((function(t){return t!=e}))},e.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach((function(e){e()}))},e}();t.HdxMediaStream=l;var u=new l;t.getRedirector=function(){return u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),o=n(6),a=n(7),s=n(1),c=function(){function e(e,t,n){this.resolve=e,this.reject=t,this.name=n}return e.prototype.post=function(e){1==e?(r.logger.log('deferred_action.post(): resolving "'+this.name+'"'),this.resolve()):(r.logger.log('deferred_action.post(): rejecting "'+this.name+'"'),this.reject())},e}();t.deferred_action=c;var d=function(e,t){this.id=e,this.is_null=t};t.rpc_callback=d;var l,u,_=function(){function e(e,t,n){this.success=new d(e<<16,t),this.fail=new d(e<<16|1,t),this.id=e,this.oneShot=n}return e.prototype.resolve=function(e){r.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(e)},e.prototype.reject=function(e){null!=this.err_handler&&this.err_handler(e)},e.prototype.then=function(e){this.handler=e},e.prototype.prom=function(){var e=this;return new Promise((function(t,n){e.handler=t,e.err_handler=n}))},e}();t.callback=_,function(e){e[e.NotConfigured=0]="NotConfigured",e[e.Configured=1]="Configured",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(l||(l={})),function(e){e[e.Local=0]="Local",e[e.Remote=1]="Remote",e[e.Pseudo=2]="Pseudo"}(u=t.ProxyMode||(t.ProxyMode={}));var g=function(){function e(t,n,c,d,_){void 0===_&&(_=null);for(var g=[],h=5;h<arguments.length;h++)g[h-5]=arguments[h];var f=this;if(this.hdxms=i.getRedirector(),this.iid=n,this.oid=c,this.mode=d,this.state=l.NotConfigured,this.deferredActions=new Array,this.cbs=new Map,d===u.Local){var p=!1;this.iid===s.class_id_t.EngineControl&&(p=!0),this.hdxms.startRedirection(p,this.user_friendly_id()).then((function(){f.oid=e.nextId++,r.logger.log(f.user_friendly_id()+" assigned local oid:"+f.oid);var t=s.WebrpcClassLibInfoUtil.getMethodFeatureByid(n,0);return f.hdxms.WSSendObjectWrapper(t,n,0,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[!1,!1,o.ws_msg_type_t.req,n,0,f.oid].concat(g)))})).then((function(e){r.logger.trace("ProxyObject: setting state to configured. (iid: "+f.iid+" oid: "+f.oid+")");var n=f.oid;f.state=l.Configured,f.oid=f.param0(e),r.logger.log(f.user_friendly_id()+" assigned remote oid for local oid:"+n),f.onConnected(),_&&_(),a.gc.trackObject(f,t)})).catch((function(){f.state=l.Error,f.onConnected()}))}else d===u.Remote&&(this.state=l.Configured,a.gc.trackObject(this,t))}return e.prototype.bind=function(e,t){if(r.logger.trace("ProxyObject: binding object. (iid: "+this.iid+" oid: "+t+" mode: "+this.mode+")"),this.mode===u.Pseudo){this.state=l.Configured;var n=this.oid;this.oid=t,r.logger.log(this.user_friendly_id()+" assigned remote oid for local oid:"+n),this.onConnected(),a.gc.trackObject(this,e),this.mode=u.Remote}else r.logger.log("ProxyObject: binding failure. incorrect mode!")},e.prototype.reconstructor=function(e,t,n){for(var i=this,c=[],d=3;d<arguments.length;d++)c[d-3]=arguments[d];this.state=l.NotConfigured,this.deferredActions=[];var u=s.WebrpcClassLibInfoUtil.getMethodFeatureByid(t,0);this.hdxms.WSSendObjectWrapper(u,t,0,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[!1,!1,o.ws_msg_type_t.req,t,0,this.oid].concat(c))).then((function(t){r.logger.trace("ProxyObject: setting state to configured. (iid: "+i.iid+" oid: "+i.oid+")");var n=i.oid;i.state=l.Configured,i.oid=i.param0(t),r.logger.log(i.user_friendly_id()+" assigned remote oid for local oid:"+n),i.onConnected(),a.gc.trackObject(i,e)})).catch((function(){i.state=l.Error,i.onConnected()}))},e.prototype.setParent=function(e){a.gc.setParent(this,e)},e.prototype.release=function(){r.logger.log(this.user_friendly_id()+".release() called."),a.gc.releaseObject(this)},e.prototype.destroy=function(){this.state=l.Destroyed;var e=s.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(e,this.iid,0,o.WsJsonUtil.createMessageByid(!1,!0,o.ws_msg_type_t.req,this.iid,0,this.oid))},e.prototype.onConnected=function(){for(;this.deferredActions&&this.deferredActions.length>0;)this.deferredActions.shift().post(this.state==l.Configured)},e.prototype.checkState=function(e,t){var n=this;e<=0?(r.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+n.iid+" oid: "+n.oid+")"),n.onConnected()):setTimeout((function(){n.state==l.Configured||n.state==l.Error||n.state==l.Destroyed?n.onConnected():(r.logger.log('ProxyObject.checkState(): count= "'+e+'". (iid: '+n.iid+" oid: "+n.oid+")"),n.checkState(--e,t))}),t)},e.prototype.waitUntilConnected=function(e){var t=this;return new Promise((function(n,i){r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.state==l.Destroyed&&(t.onConnected(),i("Object already destroyed :"+t.user_friendly_id())),t.state==l.Configured?(t.onConnected(),n()):t.state==l.Error?(r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.onConnected(),i()):(r.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+e+'". (iid: '+t.iid+" oid: "+t.oid+")"),t.deferredActions.push(new c(n,i,e)),t.checkState(15,1e3))}))},e.prototype.remoteInvoke=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(this.state==l.Destroyed)return Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id());if(this.state==l.Error)return Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id());var r=s.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,t);return this.hdxms.WSSendObjectWrapper(r,this.iid,t,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[e,!1,o.ws_msg_type_t.req,this.iid,t,this.oid].concat(n)))},e.prototype.registerCallbacks=function(t,n,i){this.unregisterCallbacks(i);var r=e.nextcbid++,o=new _(r,n,t);return n||(t||this.cbs.set(i,r),this.hdxms.registerHandler(this.iid,this.oid,o)),o},e.prototype.unregisterCallbacks=function(e){this.cbs.has(e)?(this.hdxms.unregisterHandler(this.iid,this.oid,this.cbs.get(e)),this.cbs.delete(e)):r.logger.trace(this.cbs)},e.prototype.object_id=function(){return this.oid},e.prototype.param0=function(e){return e.params[0]},e.prototype.isNullCallback=function(e){return null==e||null==e},e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.oid+"]"},e.prototype.isRedirected=function(){return this.hdxms.isRedirected()},e.prototype.isValid=function(){return!(this.state===l.Error||this.state===l.Destroyed)},e.prototype.registerStateChangeNotification=function(e){this.hdxms.registerStateChangeNotification(e)},e.prototype.unregisterStateChangeNotification=function(e){this.hdxms.unregisterStateChangeNotification(e)},e.nextId=0,e.nextcbid=0,e}();t.ProxyObject=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(2),o=n(0);!function(e){e[e.unknown=0]="unknown",e[e.active=1]="active",e[e.idle=2]="idle"}(t.tel_CallState||(t.tel_CallState={})),function(e){e[e.unknown=0]="unknown",e[e.incoming=1]="incoming",e[e.outgoing=2]="outgoing"}(t.tel_CallDirection||(t.tel_CallDirection={})),function(e){e[e.unknown=0]="unknown",e[e.audio=1]="audio",e[e.video=2]="video",e[e.multi=3]="multi",e[e.dshare=4]="dshare"}(t.tel_CallType||(t.tel_CallType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.Init=2]="Init",e[e.Data=3]="Data"}(i=t.tel_cmd||(t.tel_cmd={})),t.tel_key_ConferenceCallDuration="ConferenceCallDuration",t.tel_key_AudioCallDuration="AudioCallDuration",t.tel_key_VideoCallDuration="VideoCallDuration",t.tel_key_ScreensharingCallDuration="ScreensharingCallDuration",t.tel_key_CallEstIncoming="CallEstIncoming",t.tel_key_CallEstOutgoing="CallEstOutgoing",t.tel_key_AudioDeviceUsed="AudioDeviceUsed",t.tel_key_VideoDeviceUsed="VideoDeviceUsed",t.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed",t.tel_key_PerfCallDirection="PerfCallDirection",t.tel_key_PerfCallState="PerfCallState",t.tel_key_PerfCallType="PerfCallType",t.tel_key_VerWebrpc="VerWebrpc",t.tel_key_VerWebrtcCodecs="VerWebrtcCodecs",t.tel_key_VerReceiver="VerReceiver",t.tel_key_VerVda="VerVda",t.tel_key_VerEndpoint="VerEndpoint",t.tel_key_VerTypeScript="VerTypeScript",t.tel_key_OSFamily="OSFamily",t.tel_key_OSVersion="OSVersion",t.tel_key_OSArchitecture="OSArchitecture",t.tel_key_OSDistro="OSDistro",t.tel_key_OSEdition="OSEdition";var a=function(){function e(e,t,n,i){this.cmd=e,this.key=t,this.value=n,this.flags=i}return e.prototype.SendTelemetryData=function(e){e.SendTelemetryData(this.cmd,this.key,this.value,this.flags)},e}(),s=function(){function e(){this.id=0,this.deferredData=new Array}return e.prototype.reset=function(){this.id=0,this.deferredData=new Array},e.prototype.onInitialized=function(e){for(this.id=e;this.deferredData&&this.deferredData.length>0;)this.deferredData.shift().SendTelemetryData(this)},e.prototype.SendTelemetryInit=function(){this.id>0&&this.reset();try{r.getRedirector().WSSendObject({v:"telemetry",hdr:{command:i.Init,id:0},init:{domain:"HDX Domain Multimedia Teams",subdomain:"Teams",feature:"msteams",version:"1.1.1.1"}})}catch(e){o.logger.log(e)}},e.prototype.SendTelemetryData=function(e,t,n,s){if(e==i.Data)if(0==this.id)this.deferredData.push(new a(e,t,n,s));else try{r.getRedirector().WSSendObject({v:"telemetry",hdr:{command:e,id:this.id},data:{key:t,value:n,flags:s}})}catch(e){o.logger.log(e)}else o.logger.log("invalid telemetry command!")},e}();t.Telemetry=s},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(1),d=n(3),l=n(0),u=n(2),_=n(4);t.enumerateddecices=s;var g=function(e,t){this.type=e,this.target=t},h=function(){function e(){this.is_local_clone=!1,this.clone_count=0,this.clone_id=0}return e.prototype.clone=function(){this.clone_count++;var t=new e;return t.is_local_clone=!0,t.clone_id=this.clone_count,t},e.prototype.synchronize=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this.is_local_clone?[2,e.asyncClone()]:[2,e]}))}))},e}(),f=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.MediaStreamTrack,n,d.ProxyMode.Remote)||this;return i.refCount_=0,i.refCount_++,i.clone_state=new h,i}return r(t,e),Object.defineProperty(t.prototype,"refcount",{get:function(){return this.refCount_},enumerable:!0,configurable:!0}),t.prototype.addRef=function(){this.refCount_++,l.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)},Object.defineProperty(t.prototype,"onended",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=e,this.waitUntilConnected("MediaStreamTrack.onended").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onended);return n.then((function(e){l.logger.log(t.user_friendly_id()+"onended event received!!!");var n=new g("ended",t);t.readyState_="ended",t.onended_(n)})),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onended,n.success)})).catch((function(){l.logger.log(t.user_friendly_id()+".onended failed!!!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onmute",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=e,this.waitUntilConnected("MediaStreamTrack.onmute").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onmute);return n.then((function(e){l.logger.log(t.user_friendly_id()+"onmute event received!!!");var n=new g("mute",t);t.muted=!0,t.onmute_(n)})),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onmute,n.success)})).catch((function(){l.logger.log(t.user_friendly_id()+".onmute failed!!!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onunmute",{get:function(){return l.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(e){var t=this;l.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=e,this.waitUntilConnected("MediaStreamTrack.onunmute").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_MediaStreamTrack_t.onunmute);return n.then((function(e){l.logger.log("onunmute event received!!!");var n=new g("unmute",t);t.muted=!1,t.onunmute_(n)})),t.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.onunmute,n.success)})).catch((function(){l.logger.log(t.user_friendly_id()+".onunmute failed!!!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstop",{set:function(e){this.onstop_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return l.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(e){l.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+e+"]"),this.enabled_=e,this.remoteInvoke(!0,c.method_id_MediaStreamTrack_t.enabled,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return l.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!0,configurable:!0}),t.prototype.asyncClone=function(){return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(i){switch(i.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return i.sent(),[4,this.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.clone,[])];case 2:return e=i.sent(),n=this.param0(e),[2,new t(this,n.oid).syncBarrier()]}}))}))},t.prototype.clone=function(){l.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),n.label=this.label,n.kind=this.kind,n.enabled_=this.enabled_,n.muted=this.muted,n.readyState_=this.readyState_,n.trackSettings_=this.trackSettings_,n.clone_state=e,n.constraints_=this.constraints_,n.capabilities_=this.capabilities_,n},t.prototype.stop=function(){var e=this;l.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+this.refCount_),this.readyState_="ended",this.refCount_>0&&(this.refCount_--,0===this.refCount_&&(l.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.stop).catch((function(t){l.logger.log(e.user_friendly_id()+".stop() failed with:"+t)})),null!==this.onstop_&&this.onstop_()))},t.prototype.getCapabilities=function(){return this.capabilities_},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getSettings=function(){return"audio"==this.kind?{deviceId:(e=this.trackSettings_).deviceId,echoCancellation:e.echoCancellation}:function(e){return{aspectRatio:e.aspectRatio,deviceId:e.deviceId,frameRate:e.frameRate,height:e.height,width:e.width}}(this.trackSettings_);var e},t.prototype.applyConstraints=function(e){var t=this;return l.logger.log(this.user_friendly_id()+".applyConstraints() called."),new Promise((function(n,i){t.waitUntilConnected("MediaStreamTrack.applyConstraints").then((function(){return Promise.all([t.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.applyConstraints,e),t.syncBarrier()])})).catch((function(){i({name:"OverconstrainedError",message:"Failed to apply constraints."})})).then((function(){return t.constraints_=e,t.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getConstraints)})).then((function(e){t.constraints_=t.param0(e)})).catch((function(){l.logger.log(t.user_friendly_id()+".syncBarrier() remote client doesn't support getConstraints method. Ignore it")})).then((function(){return n()}))}))},t.convertReadyState=function(e){return 0==e?"live":"ended"},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(n,i){e.waitUntilConnected("MediaStreamTrack.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.kind,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.id,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.label,""),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.enabled,!1),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.muted,!1),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.readyState,0),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getSettings),e.remoteInvoke(!1,c.method_id_MediaStreamTrack_t.getCapabilities)])})).then((function(i){var r,o;r=i.map((function(t){return e.param0(t)})),e.kind=r[0],e.id=r[1],e.label=r[2],e.enabled_=r[3],e.muted=r[4],o=r[5],e.trackSettings_=r[6],e.capabilities_=r[7],e.readyState_=t.convertReadyState(o),n(e)})).catch((function(){i()}))}))},t}(d.ProxyObject);t.RemoteMediaTrack=f;var p=function(){},m=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.MediaStream,n,d.ProxyMode.Remote)||this;return i.clone_state=new h,i}return r(t,e),t.prototype.dumpTrackInfo=function(){l.logger.log(this.user_friendly_id()+".dumpTrackInfo() called. [id="+this.id+"]");for(var e=0,t=this.tracks_;e<t.length;e++){var n=t[e];l.logger.log(n.user_friendly_id()+" [id="+n.id+"] refcount="+n.refcount)}},t.prototype.toJSON=function(){var e=new p;return e.id=this.id,e.active=this.active,e.oid=this.object_id(),"RemoteStream:"+JSON.stringify(e)},t.prototype.getAudioTracks=function(){l.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var e=new Array,t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"audio"==i.kind&&e.push(i)}return e},t.prototype.getVideoTracks=function(){l.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var e=new Array,t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"video"==i.kind&&e.push(i)}return e},t.prototype.getTracks=function(){return l.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},t.prototype.getTrackById=function(e){l.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var t=0,n=this.tracks_;t<n.length;t++){var i=n[t];if(i.id==e)return i}},t.prototype.addTrack=function(e){l.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(e),this.remoteInvoke(!1,c.method_id_MediaStream_t.addTrack,{oid:e.object_id()})},t.prototype.removeTrack=function(e){l.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var t=this.tracks_.indexOf(e);this.tracks_.splice(t,1),this.remoteInvoke(!1,c.method_id_MediaStream_t.removeTrack,{oid:e.object_id()})},t.prototype.asyncClone=function(){return o(this,void 0,void 0,(function(){var e,n;return a(this,(function(i){switch(i.label){case 0:return l.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return i.sent(),[4,this.remoteInvoke(!1,c.method_id_MediaStream_t.clone,[])];case 2:return e=i.sent(),console.log(e),n=this.param0(e),[2,new t(this,n.oid).syncBarrier()]}}))}))},t.prototype.clone=function(){l.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),this.tracks_.forEach((function(e){e.addRef()})),n.tracks_=this.tracks_,n.clone_state=e,n},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise((function(t,n){e.waitUntilConnected("MediaStream.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,c.method_id_MediaStream_t.id,""),e.remoteInvoke(!1,c.method_id_MediaStream_t.active,!1),e.remoteInvoke(!1,c.method_id_MediaStream_t.getTracks,[])])})).then((function(t){var n;n=t.map((function(t){return e.param0(t)})),e.id=n[0],e.active=n[1];for(var i=[],r=0,o=n[2];r<o.length;r++){var a=o[r],s=new f(e,a.oid);i.push(s.syncBarrier())}return Promise.all(i)})).then((function(n){e.tracks_=[],n.forEach((function(t){t.onstop=function(){var t=!0;e.tracks_.forEach((function(e){"ended"!=e.readyState&&(t=!1)})),t&&e.release()},e.tracks_.push(t)})),t(e)})).catch((function(){n()}))}))},t}(d.ProxyObject);t.RemoteStream=m;var y=function(e){function t(t,n){return e.call(this,t,c.class_id_t.MediaStreamEvent,n,d.ProxyMode.Remote)||this}return r(t,e),t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected("MediaStreamEvent.syncBarrier").then((function(){return e.remoteInvoke(!1,c.method_id_MediaStreamEvent_t.stream,{oid:0})})).then((function(t){return new m(e,t.params[0].oid).syncBarrier()})).then((function(n){e.stream=n,t(e)})).catch((function(){n()}))}))},t}(d.ProxyObject);t.RemoteStreamEvent=y;var v=function(e){function t(t){return e.call(this,null,c.class_id_t.MediaDeviceInfo,t,d.ProxyMode.Remote)||this}return r(t,e),t.prototype.convertKind=function(e){return 0==e?"audioinput":1==e?"audiooutput":"videoinput"},t.prototype.syncBarrier=function(){var e=this;return l.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.deviceId,""),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.kind,0),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.label,""),e.remoteInvoke(!1,c.method_id_MediaDeviceInfo_t.groupId,"")])})).then((function(n){var i;e.kind=e.convertKind(e.param0(n.splice(1,1)[0])),i=n.map((function(t){return e.param0(t)})),e.deviceId=i[0],e.label=i[1],e.groupId=i[2],t(e)})).catch((function(){l.logger.log(e.user_friendly_id()+".syncBarrier(): rejected."),n()}))}))},t}(d.ProxyObject);t.RemoteDeviceInfo=v;var C=function(e){function n(){var t=e.call(this,null,c.class_id_t.MediaDevices,0,d.ProxyMode.Local,(function(){t.setDeviceChangeCallback()}))||this;return t.devices_=[],t}return r(n,e),n.prototype.enumerateDevices=function(){var e=this;return l.logger.log(this.user_friendly_id()+".enumerateDevices() called"),new Promise((function(n,i){e.waitUntilConnected("RemoteDevices.enumerateDevices").then((function(){return e.remoteInvoke(!1,c.method_id_MediaDevices_t.enumerateDevices,[])})).then((function(t){var n=[];return t.params[0].forEach((function(t){var i=e.devices_.find((function(e){return e.object_id()===t.oid}));void 0===i?(i=new v(t.oid),n.push(i.syncBarrier())):n.push(i)})),Promise.all(n)})).then((function(i){l.logger.log(e.user_friendly_id()+".enumerateDevices: returning enumerated devices with ids ["+i.map((function(e){return e.object_id()}))+"]"),n(i),e.devices_.forEach((function(e){for(var t=!0,n=0,r=i;n<r.length;n++){if(e===r[n]){t=!1;break}}t&&e.release()})),e.devices_=i,t.enumerateddecices=s=i})).catch((function(){l.logger.log(e.user_friendly_id()+".enumerateDevices() didnt get response."),e.devices_=[],i()}))}))},n.prototype.getDisplayMedia=function(e){var t=this;return new Promise((function(n,i){t.waitUntilConnected("RemoteDevices.getDisplayMedia").then((function(){var n=t.prepareDisplayConstraints(e);return t.remoteInvoke(!1,c.method_id_MediaDevices_t.getDisplayMedia,n)})).then((function(e){return new m(null,e.params[0].oid).syncBarrier()})).then((function(e){n(e)})).catch((function(){l.logger.log(t.user_friendly_id()+".getDisplayMedia() returned an error."),i(new DOMException("Unable to get a display stream.","NotReadableError"))}))}))},n.prototype.setDeviceChangeCallback=function(){var e=this;l.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called."),this.waitUntilConnected("MediaDevices.ondevicechange").then((function(){var t=e.registerCallbacks(!1,!1,c.method_id_MediaDevices_t.ondevicechange);return t.then((function(){l.logger.log(e.user_friendly_id()+".ondevicechange(): callback received!!!"),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))})),e.remoteInvoke(!0,c.method_id_MediaDevices_t.ondevicechange,t.success)})).catch((function(){l.logger.log(e.user_friendly_id()+".set_ondevicechange(): failed.")}))},n.prototype.prepareDisplayConstraints=function(e){if(u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_common_media_constraints))return e;var t={frameRate:15,width:{max:1920},height:{max:1080}};if(void 0!==e.video&&null!==e.video){var n=e.video;void 0!==n.frameRate&&void 0!==n.width&&void 0!==n.height&&(t.frameRate=n.frameRate,t.width.max=n.width.max||n.width,t.height.max=n.height.max||n.height)}return{video:t}},n}(d.ProxyObject);t.RemoteDevices=C;var T=function(e){function t(){return e.call(this,null,c.class_id_t.NavigatorUserMedia,0,d.ProxyMode.Local)||this}return r(t,e),t.prototype.webkitGetUserMedia=function(e,t,n){this.getUserMedia(e,t,n)},t.prototype.LogTelemetryDevice_=function(e){try{if(void 0!==e.audio){var t,n=e.audio.deviceId;s.forEach((function(e){n==e.deviceId&&(t=e.label)})),l.logger.log(t),this.SendTelemetryData(_.tel_key_AudioDeviceUsed,t,0)}if(void 0!==e.video){var i,r=e.video.mandatory.sourceId;s.forEach((function(e){r==e.deviceId&&(i=e.label)})),l.logger.log(i),this.SendTelemetryData(_.tel_key_VideoDeviceUsed,i,0)}}catch(e){l.logger.log(e)}},t.prototype.getUserMedia=function(e,t,n){var i=this;l.logger.log(this.user_friendly_id()+".getUserMedia() called: "+JSON.stringify(e)),this.waitUntilConnected("NavigatorUserMedia.getUserMedia").then((function(){var t=i.registerCallbacks(!0,!1,c.method_id_NavigatorUserMedia_t.getUserMedia);if(void 0!==e.audio&&0==Object.keys(e.audio).length&&(e.audio={dummy:1}),void 0!==e.video){var n=e.video;null==n.mandatory.maxFrameRate&&(n.mandatory.maxFrameRate=30),null==n.mandatory.minWidth&&(n.mandatory.minWidth=360),null==n.mandatory.maxWidth&&(n.mandatory.maxWidth=1920),null==n.mandatory.minHeight&&(n.mandatory.minHeight=180),null==n.mandatory.maxHeight&&(n.mandatory.maxHeight=1080)}return i.remoteInvoke(!1,c.method_id_NavigatorUserMedia_t.getUserMedia,e,t.success,t.fail),t.prom()})).then((function(e){return l.logger.log(i.user_friendly_id()+".getUserMedia: received success callback!"),new m(null,i.param0(e).oid).syncBarrier()})).then((function(r){var o=r;l.logger.log(i.user_friendly_id()+".getUserMedia: MediaStream ready to deliver",JSON.stringify(o)),0==o.getTracks().length?(l.logger.log(i.user_friendly_id()+".getUserMedia: reporting no tracks as error."),n({constraintName:"",name:"OverconstrainedError",message:""})):(i.LogTelemetryDevice_(e),t(o))})).catch((function(e){u.getRedirector().getFeatureValue(c.FEATURE_ms_teams_1912)?n(i.param0(e)):n({constraintName:"",name:"OverconstrainedError",message:""})}))},t.prototype.SendTelemetryData=function(e,t,n){u.getRedirector().telemetry.SendTelemetryData(_.tel_cmd.Data,e,t,n)},t}(d.ProxyObject);t.NavigatorUserMedia=T},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(1);!function(e){e[e.req=0]="req",e[e.reply=1]="reply",e[e.event_req=2]="event_req",e[e.event_reply=3]="event_reply"}(i=t.ws_msg_type_t||(t.ws_msg_type_t={}));var o=function(){function e(){}return e.createMessageByid=function(e,t,n,i,o,a){for(var s=[],c=6;c<arguments.length;c++)s[c-6]=arguments[c];var d=r.WebrpcClassLibInfoUtil.getMethodByid(i,o);return d&&d.isprop||(e=!1),this.createMessage.apply(this,[n,e,t,i,o,a].concat(s))},e.createMessage=function(e,t,n,i,r,o){for(var a=[],s=6;s<arguments.length;s++)a[s-6]=arguments[s];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(e),modifier:t,destroy:n,proc:{iid:i,methodid:r}},objref:{oid:o},params:a.slice()}},e.getMsgType=function(e){var t="";switch(e){case i.req:default:t="req";break;case i.reply:t="reply";break;case i.event_req:t="event-req";break;case i.event_reply:t="event-reply"}return t},e._version=1,e}();t.WsJsonUtil=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.object_=null,this.parent_=null,this.children_=[],this.object_=e}return e.prototype.addChild=function(e){e.parent_!=this&&(e.parent_=this,this.children_.push(e))},e.prototype.removeChild=function(e){var t=this.children_.indexOf(e);this.children_.splice(t,1),e.parent_=null},e}(),r=function(){function e(){this.root_=new i(null)}return e.prototype.trackObject=function(e,t){if(void 0===t&&(t=null),null===this.findNode(e,this.root_)){var n=this.findNode(t,this.root_),r=new i(e);n.addChild(r)}},e.prototype.releaseObject=function(e){var t=this.findNode(e,this.root_);return null!==t&&t!==this.root_&&(this.destroyNodeObjectRecurse(t),t.parent_.removeChild(t),!0)},e.prototype.destroyNodeObjectRecurse=function(e){for(var t=0,n=e.children_;t<n.length;t++){var i=n[t];this.destroyNodeObjectRecurse(i)}e.object_.destroy()},e.prototype.setParent=function(e,t){var n=this.findNode(e,this.root_);if(null===n)return!1;var i=this.findNode(t,this.root_);return null!==i&&(n.parent_===i||(n.parent_.removeChild(n),i.addChild(n)),!0)},e.prototype.reset=function(){this.root_.children_=[]},e.prototype.findNode=function(e,t){if(t.object_===e)return t;for(var n=null,i=0,r=t.children_;i<r.length;i++){var o=r[i];if(null!==(n=this.findNode(e,o)))break}return n},e}();t.GC=r,t.gc=new r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),c=n(1),d=n(0),l=n(5),u=n(9),_=n(10),g=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCDTMFToneChangeEvent,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(i){switch(i.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,this.waitUntilConnected("DTMFToneChangeEvent.syncBarrier")];case 1:return i.sent(),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCDTMFToneChangeEvent_t.tone,""),this.remoteInvoke(!1,c.method_id_RTCDTMFToneChangeEvent_t.tone_buffer,"")])];case 2:return t=i.sent(),e=t.map((function(e){return n.param0(e)})),this.tone=e[0],this.tone_buffer_=e[1],[2,this]}}))}))},Object.defineProperty(t.prototype,"tone_buffer",{get:function(){return this.tone_buffer_},enumerable:!0,configurable:!0}),t}(s.ProxyObject);t.DTMFToneChangeEvent=g;var h=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCDTMFSender,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i.canInsertDTMF=!0,i.toneBuffer_="",i}return r(t,e),t.prototype.insertDTMF=function(e,t,n){var i=this;void 0===t&&(t=100),void 0===n&&(n=70),d.logger.log(this.user_friendly_id()+".insertDTMF() called, tones: "+e),this.waitUntilConnected("DtmfSender.insertDTMF").then((function(){return i.remoteInvoke(!1,c.method_id_RTCDTMFSender_t.insertDTMF,e,t,n)})).then((function(){d.logger.log(i.user_friendly_id()+".insertDTMF() success, tones: "+e)})).catch((function(){d.logger.log(i.user_friendly_id()+".insertDTMF() failed, tones: "+e)}))},Object.defineProperty(t.prototype,"ontonechange",{get:function(){return this.ontonechange_},set:function(e){var t=this;d.logger.log(this.user_friendly_id()+".set_ontonechange() called."),this.ontonechange_=e,this.waitUntilConnected("DtmfSender.ontonechange").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_RTCDTMFSender_t.ontonechange);return n.then((function(e){d.logger.log(t.user_friendly_id()+".ontonechange callback received!"),new g(t,t.param0(e).oid).syncBarrier().then((function(e){d.logger.log(t.user_friendly_id()+"tone: "+e.tone+" tone_buffer: "+e.tone_buffer),t.toneBuffer_=e.tone_buffer,t.ontonechange_(e)})).catch((function(){d.logger.log(t.user_friendly_id()+"toneEvt.syncBarrier(): failed!")}))})),t.remoteInvoke(!0,c.method_id_RTCDTMFSender_t.ontonechange,n.success)})).catch((function(){d.logger.log(t.user_friendly_id()+".set_ontonechange(): failed!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneBuffer",{get:function(){return d.logger.log(this.user_friendly_id()+".toneBuffer() called."),this.toneBuffer_},enumerable:!0,configurable:!0}),t}(s.ProxyObject);t.DtmfSender=h;var f,p=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCIceTransport,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i.selectedPair=null,i.localCandidates_=[],i.remoteCandidates_=[],i}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var e,n,i,r,o=this;return a(this,(function(a){switch(a.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,this.waitUntilConnected("IceTransport.syncBarrier")];case 1:return a.sent(),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.role,0),this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.component,0),this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.state,0),this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.gatheringState,0)])];case 2:return n=a.sent(),0,0,e=n.map((function(e){return o.param0(e)})),this.role_=e[0],this.component_=e[1],i=e[2],r=e[3],this.state_=t.convertState(i),this.gatheringState_=t.convertGatheringState(r),this.syncCandidates().then((function(e){d.logger.log(o.user_friendly_id()+"received updated ice candidates!")})),[2,this]}}))}))},t.prototype.syncCandidates=function(){return o(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(i){switch(i.label){case 0:return d.logger.log(this.user_friendly_id()+".syncCandidates() called."),[4,this.waitUntilConnected("IceTransport.syncCandidates")];case 1:return i.sent(),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.localcandidates,[]),this.remoteInvoke(!1,c.method_id_RTCIceTransport_t.remotecandidates,[])])];case 2:return t=i.sent(),e=t.map((function(e){return n.param0(e)})),this.localCandidates_=e[0],this.remoteCandidates_=e[1],[2,this]}}))}))},Object.defineProperty(t.prototype,"role",{get:function(){return this.role_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"component",{get:function(){return this.component_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"State",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gatheringState",{get:function(){return this.gatheringState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;d.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("IceTransport.onstatechange").then((function(){var i=n.registerCallbacks(!1,n.isNullCallback(e),c.method_id_RTCIceTransport_t.onstatechange);return i.then((function(e){d.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.syncCandidates().then((function(e){d.logger.log(n.user_friendly_id()+"received updated ice candidates!")})),n.state_=t.convertState(n.param0(e)),d.logger.log(n.user_friendly_id()+"state: "+n.state_),n.onstatechange_()})),n.remoteInvoke(!0,c.method_id_RTCIceTransport_t.onstatechange,i.success)})).catch((function(){d.logger.log(n.user_friendly_id()+".set_onstatechange failed!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ongatheringstatechange",{get:function(){return this.ongatheringstatechange_},set:function(e){var n=this;d.logger.log(this.user_friendly_id()+".set_ongatheringstatechange() called."),this.ongatheringstatechange_=e,this.waitUntilConnected("IceTransport.ongatheringstatechange").then((function(){var i=n.registerCallbacks(!1,n.isNullCallback(e),c.method_id_RTCIceTransport_t.ongatheringstatechange);return i.then((function(e){d.logger.log(n.user_friendly_id()+".ongatheringstatechange callback received!"),n.syncCandidates().then((function(e){d.logger.log(n.user_friendly_id()+"received updated ice candidates!")})),n.gatheringState_=t.convertGatheringState(n.param0(e)),d.logger.log(n.user_friendly_id()+"gatheringState: "+n.gatheringState_),n.ongatheringstatechange_()})),n.remoteInvoke(!0,c.method_id_RTCIceTransport_t.ongatheringstatechange,i.success)})).catch((function(){d.logger.log(n.user_friendly_id()+".set_ongatheringstatechange failed!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onselectedcandidatepairchange",{get:function(){return this.onselectedcandidatepairchange_},set:function(e){var t=this;d.logger.log(this.user_friendly_id()+".set_onselectedcandidatepairchange() called."),this.onselectedcandidatepairchange_=e,this.waitUntilConnected("IceTransport.onselectedcandidatepairchange").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_RTCIceTransport_t.onselectedcandidatepairchange);return n.then((function(e){d.logger.log(t.user_friendly_id()+".onselectedcandidatepairchange callback received!"),t.syncCandidates().then((function(e){d.logger.log(t.user_friendly_id()+"received updated ice candidates!")})),t.selectedPair=t.param0(e),d.logger.log(t.user_friendly_id()+"selectedPair: "+t.selectedPair),t.onselectedcandidatepairchange_()})),t.remoteInvoke(!0,c.method_id_RTCIceTransport_t.onselectedcandidatepairchange,n.success)})).catch((function(){d.logger.log(t.user_friendly_id()+".set_onselectedcandidatepairchange failed!")}))},enumerable:!0,configurable:!0}),t.prototype.getLocalCandidates=function(){return this.localCandidates_},t.prototype.getRemoteCandidates=function(){return this.remoteCandidates_},t.prototype.getLocalParameters=function(){return null},t.prototype.getRemoteParameters=function(){return null},t.prototype.getSelectedCandidatePair=function(){return this.selectedPair},t.convertState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},t.convertGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},t}(s.ProxyObject);t.IceTransport=p,function(e){e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.closed=3]="closed",e[e.failed=4]="failed",e[e.max=5]="max"}(f||(f={}));var m=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCDtlsTransport,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i.state_="new",i.transport_=null,i.remoteCertificates_=[],i}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var e,t,n,i,r,o=this;return a(this,(function(a){switch(a.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCDtlsTransport_t.transport,{}),this.remoteInvoke(!1,c.method_id_RTCDtlsTransport_t.getRemoteCertificates,[])])];case 1:return t=a.sent(),e=t.map((function(e){return o.param0(e)})),n=e[0],this.remoteCertificates_=e[1],null==n||0!=n.is_null?[3,3]:(i=new p(this,n.oid),r=this,[4,i.syncBarrier()]);case 2:r.transport_=a.sent(),a.label=3;case 3:return[2,this]}}))}))},Object.defineProperty(t.prototype,"transport",{get:function(){return this.transport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"State",{get:function(){return this.state_},enumerable:!0,configurable:!0}),t.prototype.getRemoteCertificates=function(){return this.remoteCertificates_},Object.defineProperty(t.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(e){var n=this;d.logger.log(this.user_friendly_id()+".set_onstatechange() called."),this.onstatechange_=e,this.waitUntilConnected("DtlsTransport.onstatechange").then((function(){var i=n.registerCallbacks(!1,n.isNullCallback(e),c.method_id_RTCDtlsTransport_t.onstatechange);return i.then((function(e){d.logger.log(n.user_friendly_id()+".onstatechange callback received!"),n.state_=t.convertState(n.param0(e)),d.logger.log(n.user_friendly_id()+"state_: "+n.state_),n.onstatechange_()})),n.remoteInvoke(!0,c.method_id_RTCDtlsTransport_t.onstatechange,i.success)})).catch((function(){}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onerror",{get:function(){return this.onerror_},set:function(e){var t=this;d.logger.log(this.user_friendly_id()+".set_onerror() called."),this.onerror_=e,this.waitUntilConnected("DtlsTransport.onerror").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),c.method_id_RTCDtlsTransport_t.onerror);return n.then((function(e){d.logger.log(t.user_friendly_id()+".onerror callback received!");var n=t.param0(e);d.logger.log(t.user_friendly_id()+"error: "+n),t.onerror_(n)})),t.remoteInvoke(!0,c.method_id_RTCDtlsTransport_t.onerror,n.success)})).catch((function(){}))},enumerable:!0,configurable:!0}),t.convertState=function(e){return e==f.new?"new":e==f.connecting?"connecting":e==f.connected?"connected":e==f.closed?"closed":"failed"},t}(s.ProxyObject);t.DtlsTransport=m;var y=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return d.logger.log(o.user_friendly_id()+".constructor base"),o.track_=null,o.transport_=null,o.rtcpTransport_=null,o.capabilities_=null,o}return r(t,e),t.prototype.syncBarrierBase=function(){return o(this,void 0,void 0,(function(){var e,t,n,i,r,o,s,u,g,h,f,p,y=this;return a(this,(function(a){switch(a.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrierBase() called."),[4,this.waitUntilConnected("RtpSenderReceiver.syncBarrierBase")];case 1:return a.sent(),this instanceof v?(t=c.method_id_RTCRtpSender_t.track,n=c.method_id_RTCRtpSender_t.transport,i=c.method_id_RTCRtpSender_t.rtcpTransport,r=c.method_id_RTCRtpSender_t.getCapabilities):this instanceof C&&(t=c.method_id_RTCRtpReceiver_t.track,n=c.method_id_RTCRtpReceiver_t.transport,i=c.method_id_RTCRtpReceiver_t.rtcpTransport,r=c.method_id_RTCRtpReceiver_t.getCapabilities),_.RemoteSession.isFeaturePstnSupported()?[4,Promise.all([this.remoteInvoke(!1,t,{oid:this.object_id()}),this.remoteInvoke(!1,n,{oid:this.object_id()}),this.remoteInvoke(!1,i,{oid:this.object_id()}),this.remoteInvoke(!1,r,{oid:this.object_id()})])]:[3,3];case 2:return o=a.sent(),[3,5];case 3:return[4,Promise.all([this.remoteInvoke(!1,t,{oid:this.object_id()})])];case 4:o=a.sent(),a.label=5;case 5:return e=o.map((function(e){return y.param0(e)})),s=e[0],u=e[1],g=e[2],this.capabilities_=e[3],h=this,[4,Promise.all(o.map((function(){return null==s||!1!==s.is_null||null!==y.track&&y.track_.object_id()==s.oid?new Promise((function(e,t){e(null)})):new l.RemoteMediaTrack(y,s.oid).syncBarrier()}))).catch((function(){return d.logger.log(y.user_friendly_id()+"track.syncBarrier(): failed!"),null}))];case 6:return h.track_=a.sent()[0],f=this,[4,Promise.all(o.map((function(){return null==u||!1!==u.is_null||null!==y.transport_&&y.transport_.object_id()==u.oid?new Promise((function(e,t){e(null)})):new m(y,u.oid).syncBarrier()}))).catch((function(){return d.logger.log(y.user_friendly_id()+"transport.syncBarrier(): failed!"),null}))];case 7:return f.transport_=a.sent()[0],p=this,[4,Promise.all(o.map((function(){return null==g||!1!==g.is_null||null!==y.rtcpTransport_&&y.rtcpTransport_.object_id()==g.oid?new Promise((function(e,t){e(null)})):new m(y,g.oid).syncBarrier()}))).catch((function(){return d.logger.log(y.user_friendly_id()+"rtcpTransport.syncBarrier(): failed!"),null}))];case 8:return p.rtcpTransport_=a.sent()[0],[2,new Promise((function(e){e(y)}))]}}))}))},Object.defineProperty(t.prototype,"transport",{get:function(){return d.logger.log(this.user_friendly_id()+".get transport() called."),this.transport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rtcpTransport",{get:function(){return d.logger.log(this.user_friendly_id()+".get rtcpTransport() called."),this.rtcpTransport_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"track",{get:function(){return d.logger.log(this.user_friendly_id()+".get track() called.track_: "+this.track_),this.track_},enumerable:!0,configurable:!0}),t.prototype.reinitTrack=function(e){this.track_=e},t.prototype.getCapabilities=function(e){return d.logger.log(this.user_friendly_id()+".getCapabilities() called."),this.capabilities_},t.prototype.getStats=function(){d.logger.log(this.user_friendly_id()+".getStats() called.");var e=this;return new Promise((function(t,n){var i=this;e.isRedirected()?e.waitUntilConnected("RtpReceiver.getStats").then((function(){var n;i instanceof v?n=c.method_id_RTCRtpSender_t.getStats:i instanceof C&&(n=c.method_id_RTCRtpReceiver_t.getStats);var r=e.registerCallbacks(!0,!1,n);return r.then((function(e){void 0!==e.params&&0!==e.params.length&&t(u.StatsReport.fromJSON(JSON.parse(e.params[0])))})),e.remoteInvoke(!1,n,r.success)})).catch((function(){d.logger.log(e.user_friendly_id()+".getStats(): failed!"),n()})):(d.logger.log(e.user_friendly_id()+".getStats(): not in active redirection!"),t())}))},t}(s.ProxyObject);t.RtpSenderReceiver=y;var v=function(e){function t(t,n,i){var r=e.call(this,t,c.class_id_t.RTCRtpSender,n,i)||this;return d.logger.log(r.user_friendly_id()+".constructor"),r.dtmf_=null,r.params_=null,r}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var t,n,i,r=this;return a(this,(function(o){switch(o.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,e.prototype.syncBarrierBase.call(this)];case 1:return o.sent(),[4,this.waitUntilConnected("RtpSender.syncBarrier")];case 2:return o.sent(),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCRtpSender_t.dtmf,{oid:this.object_id()}),this.remoteInvoke(!1,c.method_id_RTCRtpSender_t.getParameters,{oid:this.object_id()})])];case 3:return n=o.sent(),t=n.map((function(e){return r.param0(e)})),i=t[0],this.params_=t[1],null==i||!1!==i.is_null||null!==this.dtmf_&&this.dtmf_.object_id()==i.oid||(this.dtmf_=new h(this,i.oid)),[2,new Promise((function(e){e(r)}))]}}))}))},Object.defineProperty(t.prototype,"dtmf",{get:function(){return d.logger.log(this.user_friendly_id()+".get dtmf() called."),this.dtmf_},enumerable:!0,configurable:!0}),t.prototype.setParameters=function(e){var t=this;return d.logger.log(this.user_friendly_id()+".setParameters() called."),new Promise((function(n,i){t.waitUntilConnected("RtpSender.setParameters").then((function(){return Promise.all([t.remoteInvoke(!1,c.method_id_RTCRtpSender_t.setParameters,e)])})).then((function(i){d.logger.log(t.user_friendly_id()+".setParameters(): success."),n(),t.params_=e})).catch((function(){d.logger.log(t.user_friendly_id()+".setParameters(): rejected."),i()}))}))},t.prototype.getParameters=function(){return d.logger.log(this.user_friendly_id()+".getParameters() called."),this.params_},t.prototype.replaceTrack=function(e){var t=this;return d.logger.log(this.user_friendly_id()+".replaceTrack() called."),new Promise((function(n,i){t.waitUntilConnected("RtpSender.replaceTrack").then((function(){return Promise.all([t.remoteInvoke(!1,c.method_id_RTCRtpSender_t.replaceTrack,{oid:e.object_id()})])})).then((function(i){d.logger.log(t.user_friendly_id()+".replaceTrack(): success."),n(),t.reinitTrack(e)})).catch((function(){d.logger.log(t.user_friendly_id()+".setParameters(): rejected."),i()}))}))},t}(y);t.RtpSender=v;var C=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCRtpReceiver,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i.contribsources_=[],i.syncsources_=[],i.params_=null,i}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var t,n,i=this;return a(this,(function(r){switch(r.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,e.prototype.syncBarrierBase.call(this)];case 1:return r.sent(),[4,this.waitUntilConnected("RtpReceiver.syncBarrier")];case 2:return r.sent(),_.RemoteSession.isFeaturePstnSupported()?[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCRtpReceiver_t.getContributingSources,[]),this.remoteInvoke(!1,c.method_id_RTCRtpReceiver_t.getSynchronizationSources,[]),this.remoteInvoke(!1,c.method_id_RTCRtpReceiver_t.getParameters,{oid:this.object_id()})])]:[3,4];case 3:return n=r.sent(),[3,6];case 4:return[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCRtpReceiver_t.getContributingSources,[])])];case 5:n=r.sent(),r.label=6;case 6:return t=n.map((function(e){return i.param0(e)})),this.contribsources_=t[0],this.syncsources_=t[1],this.params_=t[2],[2,new Promise((function(e){e(i)}))]}}))}))},t.prototype.getContributingSources=function(){var e=this;return d.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources_)),this.waitUntilConnected("RtpReceiver.getContributingSources").then((function(){return Promise.all([e.remoteInvoke(!1,c.method_id_RTCRtpReceiver_t.getContributingSources,[])])})).then((function(t){e.contribsources_=t.map((function(t){return e.param0(t)}))[0]})).catch((function(){d.logger.log(e.user_friendly_id()+".getContributingSources() didnt get response."),e.contribsources_=[]})),this.contribsources_},t.prototype.getParameters=function(){return d.logger.log(this.user_friendly_id()+".getParameters() called."),this.params_},t.prototype.getSynchronizationSources=function(){return d.logger.log(this.user_friendly_id()+".getSynchronizationSources() called."),this.syncsources_},t}(y);t.RtpReceiver=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.items=[]}return e.fromJSON=function(t){for(var n=new e,i=0,o=t;i<o.length;i++){var a=o[i],s=r.fromJSON(a);n.items.push(s)}return n},e.prototype.toJSON=function(){return JSON.stringify(this.items)},e.prototype.result=function(){return this.items},e}();t.StatsReport=i;var r=function(){function e(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return e.fromJSON=function(t){var n=new e;return n.id=t.id||"",n.timestamp=t.timestamp||"",n.type=t.type||"",Object.keys(t).forEach((function(e){"id"!==e&&"timestamp"!==e&&"type"!==e&&(n.names_.push(e),n.stat_.set(e,t[e]))})),n},e.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},e.prototype.names=function(){return this.names_},e.prototype.stat=function(e){return this.stat_.get(e)},e}();t.Stats=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(2),o=n(1),a=n(13),s=n(0),c=n(1),d=n(4);!function(e){e[e.Unknown=0]="Unknown",e[e.Windows=1]="Windows",e[e.Linux=2]="Linux"}(i=t.RemoteType||(t.RemoteType={}));var l=function(){};t.SessionInfo=l;var u=function(){function e(){var e=this;this.isremote_=!1,this.isremote_=!0,this.type_=i.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,r.getRedirector().setRemoteSessionInfoCb((function(){return e.remoteSessionInfo()})),this.enginecontrol_=new a.EngineControl}return e.prototype.release=function(){r.getRedirector().setRemoteSessionInfoCb(null)},e.prototype.user_friendly_id=function(){return"[RemoteSession]"},e.prototype.getFeatureFlags=function(){var e={};return null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach((function(t){e[t.name]=t.value})),e},e.prototype.isFeatureSupported=function(e){if("video"===e)return!0;if(!(e in c.featureNameMap))return!1;for(var t=c.featureNameMap[e],n=this.getFeatureFlags(),i=0;i<t.length;i++)if(!(t[i]in n)||!0!==n[t[i]])return!1;return!0},e.isFeaturePstnSupported=function(){return e.pstn_},e.prototype.getSessionInfo=function(){return s.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()},e.prototype.remoteSessionInfo=function(){var t=this,n=this;return s.logger.log(n.user_friendly_id()+".remoteSessionInfo() called."),new Promise((function(i,c){n.enginecontrol_.syncBarrier().then((function(r){s.logger.log(n.user_friendly_id()+"enginecontrol info received!"),n.sessioninfo_=new l,n.sessioninfo_.type_script=o.HDXMS_VERSION;var c=r.version_.major.toString()+"."+r.version_.minor.toString()+"."+r.version_.revision.toString()+"."+r.version_.build.toString();if(n.sessioninfo_.webrpc=c,null!=r.versions_&&null!=r.versions_){n.SendTelemetryData(d.tel_key_VerTypeScript,o.HDXMS_VERSION,1);for(var u=0,_=0,g=r.versions_;_<g.length;_++){var h=g[_],f=h.major.toString()+"."+h.minor.toString()+"."+h.revision.toString()+"."+h.build.toString();switch(u){case a.VersionType.Webrpc:n.sessioninfo_.webrpc=f,n.SendTelemetryData(d.tel_key_VerWebrpc,f,1);break;case a.VersionType.WebrtcCodecs:n.sessioninfo_.webrtc_codecs=f,n.SendTelemetryData(d.tel_key_VerWebrtcCodecs,f,1);break;case a.VersionType.Receiver:n.sessioninfo_.receiver=f,n.SendTelemetryData(d.tel_key_VerReceiver,f,1);break;case a.VersionType.Vda:n.sessioninfo_.vda=f,n.SendTelemetryData(d.tel_key_VerVda,f,1);break;case a.VersionType.Endpoint:n.sessioninfo_.endpoint=f,n.SendTelemetryData(d.tel_key_VerEndpoint,f,1);break;default:s.logger.log(n.user_friendly_id()+"Unknown version type!")}u++}}null!=r.osinfo_&&null!=r.osinfo_&&(n.sessioninfo_.osinfo=r.osinfo_,n.SendTelemetryData(d.tel_key_OSFamily,r.osinfo_.family,1),n.SendTelemetryData(d.tel_key_OSVersion,r.osinfo_.version,1),n.SendTelemetryData(d.tel_key_OSArchitecture,r.osinfo_.architecture,1),n.SendTelemetryData(d.tel_key_OSDistro,r.osinfo_.distro,1),n.SendTelemetryData(d.tel_key_OSEdition,r.osinfo_.edition,1)),e.pstn_=t.isFeatureSupported(o.FEATURE_public_pstn),i(n.sessioninfo_),n.enginecontrol_.release()})).catch((function(){r.getRedirector().isPingActive()?n.retrySessionInfo():(c(),n.enginecontrol_.release(),n.enginecontrol_=null)}))}))},e.prototype.retrySessionInfo=function(){var e=this;setTimeout((function(){s.logger.log("checking if we are connected..."),e.enginecontrol_.bind(),r.getRedirector().handleRemoteSessionInfo()}),15e3)},e.prototype.SendTelemetryData=function(e,t,n){r.getRedirector().telemetry.SendTelemetryData(d.tel_cmd.Data,e,t,n)},e.pstn_=!1,e}();t.RemoteSession=u},function(e,t,n){var i=n(12),r=n(5),o=n(16),a=n(17),s=n(18),c=n(0).logger,d=n(10),l=n(7).gc,u=n(2);("undefined"!=typeof self?self:this).CitrixWebRTC=function(){"use strict";var e=i.PeerConnection,t=new r.NavigatorUserMedia,n=new r.RemoteDevices,_=null,g=void 0;function h(){void 0!==window.getCitrixWebrtcRedir&&window.getCitrixWebrtcRedir().then((function(e){c.log("sucesss on connect"+e),1===e&&""!==e&&null===p&&(c.log("supported client"),p=new d.RemoteSession)}))}var f=!1;window.onVdiClientDisconnected=function(e){if(c.log("VDI Event: vdiClientDisconnected"),c.log("VDI : cleanup"),t=null,n=null,_=null,p&&p.release(),p=null,l.reset(),c.log("VDI : cleanup done"),!0===e&&!1===f){c.log("VDI Event: vdiClientDisconnected with failure reported"),f=!0;try{g({event:"vdiClientDisconnected",reason:"failure",msg:"Websocket Connection Failure"})}catch(e){c.log("onVMEvent(): exception: "+e.message)}}else{f=!1;try{g({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(e){c.log("onVMEvent(): exception: "+e.message)}}};var p=new d.RemoteSession;function m(e){if(1===e&&""!==e&&(c.log("Supported client"),u.getRedirector().pingConnectionBegin(!0)),0===e&&""!==e){c.log("VDI Event: Unsupported client reported");try{g({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(e){c.log("onVMEvent(): exception: "+e.message)}}else c.log("Citrix Webrtc Redir Reg Key value is incorrect")}return window.onVdiClientDisconnectedTimer=function(){c.log("VDI Event: onVdiClientDisconnectedTimer"),null===p&&(p=new d.RemoteSession)},window.onVdiClientConnected=function(){c.log("VDI Event: vdiClientConnected"),s.FrameTracker.sendOverlayInfo(),c.log("VDI: sendSessionInfo"),p&&p.getSessionInfo().then(e=>{c.log("getSessionInfo success! info:"+JSON.stringify(e));try{g({event:"vdiClientConnected",version:e})}catch(e){c.log("onVMEvent(): exception: "+e.message)}}).catch(()=>{c.log("getSessionInfo failure! session is not fully connected yet...")}),null!==n&&n.isValid()||(n=new r.RemoteDevices),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))},{CitrixPeerConnection:e,getUserMedia:function(e,n,i){return h(),c.log("VDI Shim getUserMedia"),null!==t&&t.isValid()||(t=new r.NavigatorUserMedia),t.webkitGetUserMedia(e,n,i)},enumerateDevices:function(){return h(),c.log("VDI Shim enumerateDevices"),null!==n&&n.isValid()||(n=new r.RemoteDevices),n.enumerateDevices()},getDisplayMedia:function(e){return h(),c.log("VDI Shim getDisplayMedia"),null!==n&&n.isValid()||(n=new r.RemoteDevices),n.getDisplayMedia(e)},mapVideoElement:function(e){c.log("VDI New Video Element Created, Creating Mapping to VDA"),null===_&&(_=new s.FrameTracker),void 0===e.VDAVideoElement?(h(),Object.defineProperty(e,"VDAVideoElement",{writable:!0,value:null}),e.VDAVideoElement=new o.VideoElement,e.VDAVideoElement.onloadedmetadata=()=>{var t=new Event("loadedmetadata");e.dispatchEvent(t)},e.VDAVideoElement.ontimeupdate=()=>{var t=new Event("timeupdate");e.dispatchEvent(t)},e.VDAVideoElement.onconnectionstatechange=()=>{"connected"===e.VDAVideoElement.connectionState?_.track(e,t=>{e.VDAVideoElement.setFrame(t)}):_.untrack(e)},Object.defineProperty(e,"sinkId",{get:function(){return e.VDAVideoElement.sinkId},set:function(t){c.log("VDI Shim set video element SinkId value = "+t),e.VDAVideoElement.sinkId=t}}),Object.defineProperty(e,"srcObject",{get:function(){return e.VDAVideoElement.srcObject},set:function(t){c.log("VDI Shim set video element srcObject"),e.VDAVideoElement.srcObject=t}}),Object.defineProperty(e,"videoWidth",{get:function(){return e.VDAVideoElement.videoWidth}}),Object.defineProperty(e,"videoHeight",{get:function(){return e.VDAVideoElement.videoHeight}})):c.log("Video element is already configured!")},mapAudioElement:function(e){c.log("VDI New Audio Element Created, Creating Mapping to VDA"),void 0===e.VDAAudioElement?(h(),Object.defineProperty(e,"VDAAudioElement",{writable:!0,value:null}),e.VDAAudioElement=new a.AudioElement,Object.defineProperty(e,"sinkId",{get:function(){return e.VDAAudioElement.sinkId},set:function(t){c.log("VDI Shim set audio element SinkId value = "+t),e.setSinkId(t).then(()=>{c.log("VDI Shim set audio element SinkId success")}).catch(()=>{c.log("VDI Shim set audio element SinkId failure")})}}),e.setSinkId=function(t){c.log("VDI Shim set audio element SinkId value = "+t);const n=e.VDAAudioElement.setSinkId(t);var i,o=t;return r.enumerateddecices.forEach((function(e){o===e.deviceId&&(i=e.label)})),function(e){u.getRedirector().SendTelemetryData_Speaker(e)}(i),n},Object.defineProperty(e,"srcObject",{get:function(){return e.VDAAudioElement.srcObject},set:function(t){if(c.log("VDI Shim set audio element srcObject "+JSON.stringify(t)),null==t){if(null!==e.VDAAudioElement.srcObject){let t=e.remoteAudioElement.srcObject.getTracks();for(let e of t)e.enabled=!1}e.VDAAudioElement.release()}else{e.VDAAudioElement.srcObject=t;let n=t.getTracks();for(let e of n)e.enabled=!0}}})):c.log("Audio element is already configured!")},addClipRect:function(e){c.log("VDI Adding Occlusion "+JSON.stringify(e)),null===_&&(_=new s.FrameTracker),_.addOcclusion(e)},removeClipRect:function(e){c.log("VDI Removing Occlusion "+JSON.stringify(e)),null===_&&(_=new s.FrameTracker),_.removeOcclusion(e)},setVMEventCallback:function(e){g=e,c.log("VDI Event Callback Set")},isFeatureOn:function(e){return null!==p&&p.isFeatureSupported(e)},initLog:function(e){c.setMSLogger(e),c.log("VDI init logger")},onConnectionChange:function(e){c.log("VDI : onConnectionChange to "+e),!1===e?c.log("Disconnecting from the VDA"):(c.log("Connecting to the VDA"),window.getCitrixWebrtcRedir().then((function(e){c.log("Sucesss on connect with Reg value :"+e),""===e?(c.log("Citrix Webrtc Redir Reg key not updated - Start timer"),function e(t){if(t<=0){c.log("VDI Event: Reg Key not Updated after timer reported, Fallback");try{g({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix Webrtc Redir Reg Key not Present"})}catch(e){c.log("onVMEvent(): exception: "+e.message)}}else window.getCitrixWebrtcRedir().then((function(n){""===n?setTimeout((function(){c.log("Timer waiting for registry to be updated count :"+t),e(--t)}),1e3):m(n)}))}(5)):m(e)})).catch((function(){c.log("Failure to Read Citrix Webrtc Redir Reg Key")})))}}}()},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),c=n(5),d=n(8),l=n(3),u=n(14),_=n(15),g=n(1),h=n(0),f=n(9),p=n(4);var m=function(e){function t(t,n,i){var r=e.call(this,t,g.class_id_t.RTCIceCandidateEvent,n,l.ProxyMode.Remote)||this;return r.target=i,r.type="icecandidate",r}return r(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then((function(){return e.remoteInvoke(!1,g.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})})).then((function(t){var n=e.param0(t);return!1===n.is_null?new u.IceCandidate(e,n.oid).syncBarrier():Promise.resolve(null)})).then((function(n){h.logger.log(e.user_friendly_id()+".onicecandidate: icecandidate available!"),e.candidate_=n,t(e)})).catch((function(){h.logger.log(e.user_friendly_id()+".onicecandidate() failed."),n()}))}))},t}(l.ProxyObject);t.IceCandidateEvent=m;var y=function(){function e(e){this.state_="new",this.candidates_=[],this.pc_=e}return e.prototype.pushState=function(e){h.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+e),this.state_=e,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},e.prototype.addIceCandidate=function(e){var t=this;this.candidates_.push(e),e.syncBarrier().then((function(e){return h.logger.log(t.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),Promise.all([t.pc_.updateLocalDescription(),Promise.resolve(e)])})).then((function(e){t.postIceCandidate(e[1])}))},e.prototype.postIceCandidate=function(e){h.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(e):h.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},e.prototype.postUpdate=function(){h.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var e=new C("onicegatheringstatechange",this.pc_);this.pc_.onicegatheringstatechange(e)},e.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):h.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map((function(e){return e.object_id()}))+"], state="+this.state_)},e}(),v=function(e){function t(t,n,i){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return e.apply(this,[t,g.class_id_t.RTCSessionDescription,n,i,null].concat(r))||this}return r(t,e),t.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(t.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return h.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected(e.user_friendly_id()+".syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,g.method_id_RTCSessionDescription_t.type,0),e.remoteInvoke(!1,g.method_id_RTCSessionDescription_t.sdp,"")])})).then((function(n){e.type_=e.convertType(e.param0(n[0])),e.sdp_=e.param0(n[1]),t(e)})).catch((function(){n()}))}))},t.prototype.convertType=function(e){return 0==e?"offer":1==e?"pranswer":"answer"},t.convertC2H=function(e){return"offer"==e?0:"pranswer"==e?1:2},t}(l.ProxyObject);t.SessionDescription=v;var C=function(e,t){this.type=e,this.target=t},T=function(){},b=function(){function e(e,t){this.local=e,this.remote=t}return Object.defineProperty(e.prototype,"active",{get:function(){var e=!1;return 1!=this.local&&1!=this.remote||(e=!0),e},enumerable:!0,configurable:!0}),e}(),R=function(e){function t(t){var n,i=e.call(this,null,g.class_id_t.RTCPeerConnection,0,l.ProxyMode.Local,null,null!=(n=t)?n:{},{})||this;return i.timeerstarted_=!1,i.firsttimeremoteoffer_=!1,i.firststable_=!1,i.firsttimelocaloffer_=!1,i.audiocall_=new b(!1,!1),i.videocall_=new b(!1,!1),i.screensharingcall_=new b(!1,!1),i.conferencecall_=!1,i.incomingcall_=!1,i.outgoingcall_=!1,h.logger.log(i.user_friendly_id()+".constructor"),i.localStreams=[],i.remoteStreams=[],i.onaddstream_=null,i.signalingState_="stable",i.iceConnectionState_="new",i.iceGatheringState_="new",i.iceQ_=new y(i),i.receivers_=[],i.senders_=[],i.registerStateChangeNotification(i.onStateChange),i}return r(t,e),t.prototype.onStateChange=function(){var e=new C("iceconnectionstatechange",this);this.oniceconnectionstatechange_&&this.oniceconnectionstatechange_(e)},t.prototype.addIceCandidate=function(){h.logger.log(this.user_friendly_id()+".addIceCandidate"),h.logger.log(arguments)},Object.defineProperty(t.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=e,this.waitUntilConnected(this.user_friendly_id()+".onicecandidate").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onicecandidate);return n.then((function(e){h.logger.log(t.user_friendly_id()+".onicecandidate callback received!!!");var n=new m(t,t.param0(e).oid,t);null!=t.iceQ_&&t.iceQ_.addIceCandidate(n)})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onicecandidate,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onicecandidate() failed.")}))},enumerable:!0,configurable:!0}),t.prototype.convertIceConnectionState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},Object.defineProperty(t.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".oniceconnectionstatechange").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return n.then((function(e){h.logger.log(t.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),t.iceConnectionState_=t.convertIceConnectionState(t.param0(e));var n=new C("iceconnectionstatechange",t);t.oniceconnectionstatechange_(n)})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.oniceconnectionstatechange,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_oniceconnectionstatechange() failed.")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return h.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!0,configurable:!0}),t.prototype.convertIceGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},Object.defineProperty(t.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onicegatheringstatechange").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onicegatheringstatechange);return n.then((function(e){h.logger.log(t.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),t.iceGatheringState_=t.convertIceGatheringState(t.param0(e)),null!=t.iceQ_&&t.iceQ_.pushState(t.iceGatheringState_)})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onicegatheringstatechange,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onicegatheringstatechange() failed.")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return h.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!0,configurable:!0}),t.prototype.convertSignalState=function(e){return 0==e?"stable":1==e?"have-local-offer":2==e?"have-local-pranswer":3==e?"have-remote-offer":4==e?"have-remote-pranswer":"closed"},t.prototype.TelemtryReadings_=function(){if("have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),0==this.outgoingcall_&&(this.SendTelemetryData(p.tel_key_PerfCallState,p.tel_CallState.active,1),this.SendTelemetryData(p.tel_key_PerfCallDirection,p.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0),"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(p.tel_key_PerfCallState,p.tel_CallState.active,1),this.SendTelemetryData(p.tel_key_PerfCallDirection,p.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0),"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.timeerstarted_=!0,this.firststable_=!0),"stable"==this.signalingState_){for(var e=0,t=this.localStreams;e<t.length;e++){var n=t[e];n.getAudioTracks().length>=1&&0==this.audiocall_.local&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.audio,1),this.audiocall_.local=!0);var i=n.getVideoTracks();if(i.length>=1)for(var r=0,o=i;r<o.length;r++){1==(c=o[r]).getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.video,1),this.videocall_.local=!0)}}for(var a=0,s=this.remoteStreams;a<s.length;a++){var c;(c=s[a]).getAudioTracks().length>=1&&0==this.audiocall_.remote&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.audio,1),this.audiocall_.remote=!0);var d=c.getVideoTracks();if(d.length>=1)for(var l=0,u=d;l<u.length;l++){1==u[l].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.video,1),this.videocall_.remote=!0)}}this.getReceivers().length>2&&0==this.conferencecall_&&(this.SendTelemetryData(p.tel_key_PerfCallType,p.tel_CallType.multi,1),this.conferencecall_=!0)}},Object.defineProperty(t.prototype,"onsignalingstatechange",{set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=e,this.waitUntilConnected(this.user_friendly_id()+".onsignalingstatechanged").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onsignalingstatechange);return n.then((function(e){h.logger.log(t.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),t.signalingState_=t.convertSignalState(t.param0(e));var n=new C("onsignalingstatechange",t);t.onsignalingstatechange_(n),t.TelemtryReadings_()})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onsignalingstatechange,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onsignalingstatechange(): failed.")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ontrack",{get:function(){return this.ontrack_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_ontrack() called."),this.ontrack_=e,this.waitUntilConnected(this.user_friendly_id()+".ontrack").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.ontrack);return n.then((function(e){return o(t,void 0,void 0,(function(){var t,n,i,r,o,s,l,u,g;return a(this,(function(f){switch(f.label){case 0:return h.logger.log(this.user_friendly_id()+".ontrack(): callback received!!!"),t=this.param0(e),void 0!==(n=this.receivers_.find((function(e){return!1===t.receiver.is_null&&e.object_id()===t.receiver.oid})))?[3,2]:[4,(n=new d.RtpReceiver(this,t.receiver.oid)).syncBarrier()];case 1:f.sent(),this.receivers_.push(n),f.label=2;case 2:return!1!==t.transceiver.is_null||null!==this.transceiver_&&this.transceiver_.object_id()==t.transceiver.oid?[3,4]:(this.transceiver_=new _.RtpTransceiver(this,t.transceiver.oid),[4,this.transceiver_.syncBarrier()]);case 3:f.sent(),f.label=4;case 4:i=[],r=function(e){var t;return a(this,(function(n){switch(n.label){case 0:return void 0!==(t=o.remoteStreams.find((function(t){return!1===e.is_null&&t.object_id()===e.oid})))?[3,2]:[4,(t=new c.RemoteStream(o,e.oid)).syncBarrier()];case 1:n.sent(),n.label=2;case 2:return i.push(t),[2]}}))},o=this,s=0,l=t.streams,f.label=5;case 5:return s<l.length?(u=l[s],[5,r(u)]):[3,8];case 6:f.sent(),f.label=7;case 7:return s++,[3,5];case 8:return this.remoteStreams=i,(g=new T).receiver=n,g.streams=this.remoteStreams,g.transceiver=this.transceiver_,g.track=n.track,h.logger.log(this.user_friendly_id()+".ontrack(): notified!!!"),this.ontrack_(g),[2]}}))}))})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.ontrack,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_ontrack(): failed.")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return h.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=e,this.waitUntilConnected(this.user_friendly_id()+".onnegotiationneeded").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onnegotiationneeded);return n.then((function(){h.logger.log(t.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var e=new C("negotiationneeded",t);t.onnegotiationneeded_(e)})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onnegotiationneeded,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onnegotiationneeded(): failed.")}))},enumerable:!0,configurable:!0}),t.prototype.fix_constraints=function(e){var t={audio:!0,video:!0};return e&&(void 0!==typeof e.video&&(t.video=e.offerToReceiveVideo),void 0!==typeof e.audio&&(t.audio=e.offerToReceiveAudio)),t},t.prototype.createOffer=function(e,t,n){var i=this;h.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(n)),this.waitUntilConnected(this.user_friendly_id()+".createOffer").then((function(){var e=i.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.createOffer);return i.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.createOffer,e.success,e.fail,i.fix_constraints(n)),e.prom()})).then((function(e){return h.logger.log(i.user_friendly_id()+".createOffer(): success callback received!!!"),new v(i,i.param0(e).oid,l.ProxyMode.Remote).syncBarrier()})).then((function(t){e&&e(t)})).catch((function(){h.logger.log(i.user_friendly_id()+".createOffer() failed."),t&&t(new DOMException("PeerConnection.createOffer() failed.","PeerConnection"))}))},t.prototype.createAnswer=function(e,t,n){var i=this;h.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(n)),this.waitUntilConnected(this.user_friendly_id()+".createAnswer").then((function(){var e=i.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.createAnswer);return i.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.createAnswer,e.success,e.fail,i.fix_constraints(n),{}),e.prom()})).then((function(e){return h.logger.log(i.user_friendly_id()+".createAnswer(): success callback received!!!"),new v(i,i.param0(e).oid,l.ProxyMode.Remote).syncBarrier()})).then((function(t){e&&e(t)})).catch((function(){h.logger.log(i.user_friendly_id()+".createAnswer() failed."),t&&t("PeerConnection::createAnswer() failed.")}))},t.prototype.updateLocalDescription=function(){return o(this,void 0,void 0,(function(){var e,t,n=this;return a(this,(function(i){switch(i.label){case 0:return h.logger.log(this.user_friendly_id()+".updateLocalDescription() called."),[4,this.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.localDescription,{oid:this.object_id()})];case 1:return e=i.sent(),[4,new v(this,this.param0(e).oid,l.ProxyMode.Remote).syncBarrier().catch((function(){return h.logger.log(n.user_friendly_id()+"sdp.syncBarrier(): failed!"),null}))];case 2:return t=i.sent(),this.localDescription=t,[2]}}))}))},t.prototype.setLocalDescription=function(e,t,n){var i=this;h.logger.log(this.user_friendly_id()+".setLocalDescription() called."),this.waitUntilConnected(this.user_friendly_id()+".setLocalDescription").then((function(){return new v(i,0,l.ProxyMode.Local,{type:v.convertC2H(e.type),sdp:e.sdp}).syncBarrier()})).then((function(e){var n=i.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setLocalDescription);i.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.setLocalDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then((function(){h.logger.log(i.user_friendly_id()+".setLocalDescription(): success callback received!!!"),i.localDescription=e,t&&t()}))})).catch((function(){h.logger.log(i.user_friendly_id()+".setLocalDescription() failed."),n&&n("PeerConnection::setLocalDescription() failed.")}))},t.prototype.setRemoteDescription=function(e,t,n){var i=this;h.logger.log(this.user_friendly_id()+".setRemoteDescription() called."),this.waitUntilConnected(this.user_friendly_id()+".setRemoteDescription").then((function(){return new v(i,0,l.ProxyMode.Local,{type:v.convertC2H(e.type),sdp:e.sdp}).syncBarrier()})).then((function(e){var n=i.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.setRemoteDescription);i.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.setRemoteDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then((function(){h.logger.log(i.user_friendly_id()+".setRemoteDescription(): success callback received!!!"),i.remoteDescription=e,t&&t(),i.getSenders()}))})).catch((function(){h.logger.log(i.user_friendly_id()+".setRemoteDescription() failed."),n&&n("PeerConnection::setRemoteDescription() failed.")}))},t.prototype.getLocalStreams=function(){h.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]");for(var e=0,t=this.localStreams;e<t.length;e++){var n=t[e];h.logger.log(JSON.stringify(n))}return this.localStreams},t.prototype.getRemoteStreams=function(){h.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var e=0,t=this.remoteStreams;e<t.length;e++){var n=t[e];h.logger.log(JSON.stringify(n))}return this.remoteStreams},t.prototype.addTrack=function(e,t){var n=this;h.logger.log(this.user_friendly_id()+".addTrack() called: "+JSON.stringify(t));var i=[];if(t instanceof c.RemoteStream)i.push(t.id);else for(var r=0;r<t.length;r++)i.push(t[r].id);var o=new d.RtpSender(this,0,l.ProxyMode.Pseudo);return this.senders_.push(o),this.waitUntilConnected(this.user_friendly_id()+".addTrack").then((function(){return n.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.addTrack,{oid:e.object_id()},i)})).then((function(e){h.logger.log(n.user_friendly_id()+".addTrack() success with oid: "+n.param0(e).oid),o.bind(n,n.param0(e).oid),o.syncBarrier().catch((function(){h.logger.log(n.user_friendly_id()+"sender.syncBarrier(): failed!")}))})).catch((function(e){var t=n.param0(e);h.logger.log(n.user_friendly_id()+".addTrack() failed with error: "+t)})),h.logger.log(this.user_friendly_id()+".addTrack() returning: "+o),o},t.prototype.removeTrack=function(e){var t=this;h.logger.log(this.user_friendly_id()+".removeTrack() called.");for(var n=0;n<this.senders_.length;n++)this.senders_[n]==e&&this.senders_.splice(n,1);this.waitUntilConnected(this.user_friendly_id()+".removeTrack").then((function(){return t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.removeTrack,{oid:e.object_id()})})).then((function(){h.logger.log(t.user_friendly_id()+".removeTrack() success.")})).catch((function(){h.logger.log(t.user_friendly_id()+".removeTrack() failed.")}))},t.prototype.addStream=function(e){var t=this;h.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(e)),e.dumpTrackInfo(),this.localStreams.push(e),this.waitUntilConnected(this.user_friendly_id()+".addStream").then((function(){return t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.addStream,{oid:e.object_id()},{})})).then((function(){h.logger.log(t.user_friendly_id()+".addStream() success.")})).catch((function(){h.logger.log(t.user_friendly_id()+".addStream() failed.")}))},t.prototype.removeStream=function(e){var t=this;h.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(e));for(var n=0;n<this.localStreams.length;n++)this.localStreams[n]==e&&this.localStreams.splice(n,1);this.waitUntilConnected(this.user_friendly_id()+".removeStream").then((function(){return t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.removeStream,{oid:e.object_id()})})).then((function(){h.logger.log(t.user_friendly_id()+".removeStream() success.")})).catch((function(){h.logger.log(t.user_friendly_id()+".removeStream() failed.")}))},Object.defineProperty(t.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=e,this.waitUntilConnected(this.user_friendly_id()+".onaddstream").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onaddstream);return n.then((function(e){new c.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then((function(e){h.logger.log(t.user_friendly_id()+".onaddstream callback received!"),void 0===t.remoteStreams.find((function(t){return null!=e.stream&&t.object_id()===e.stream.object_id()}))&&t.remoteStreams.push(e.stream),null!=t.onaddstream_&&t.onaddstream_(e)}))})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onaddstream,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onaddstream(): failed!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(e){var t=this;h.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=e,this.waitUntilConnected(this.user_friendly_id()+".onremovestream").then((function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),g.method_id_RTCPeerConnection_t.onremovestream);return n.then((function(e){new c.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then((function(e){h.logger.log(t.user_friendly_id()+".onremovestream callback received!");var n=t.remoteStreams.findIndex((function(t){return t.id==e.stream.id}));n>=0&&t.remoteStreams.splice(n,1),t.onremovestream_(e)}))})),t.remoteInvoke(!0,g.method_id_RTCPeerConnection_t.onremovestream,n.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".set_onremovestream(): failed!")}))},enumerable:!0,configurable:!0}),t.prototype.getStats=function(e){var t=this;return new Promise((function(n,i){t.isRedirected()?t.waitUntilConnected(t.user_friendly_id()+".getStats").then((function(){var i=t.registerCallbacks(!0,!1,g.method_id_RTCPeerConnection_t.getStats);return i.then((function(t){void 0!==t.params&&0!==t.params.length&&(e(f.StatsReport.fromJSON(JSON.parse(t.params[0]))),n())})),t.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getStats,i.success)})).catch((function(){h.logger.log(t.user_friendly_id()+".getStats(): failed!"),i()})):(h.logger.log(t.user_friendly_id()+".getStats(): not in active redirection!"),e({}),n())}))},t.prototype.SendTelemetryData=function(e,t,n){s.getRedirector().telemetry.SendTelemetryData(p.tel_cmd.Data,e,t,n)},t.prototype.MillisecondstoDisplayformat_=function(e){var t,n,i,r;r=Math.floor(e/1e3),i=Math.floor(r/60),r%=60,n=Math.floor(i/60),i%=60,t=Math.floor(n/24),n%=24,h.logger.log(t+":"+n+":"+i+":"+r)},t.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.timeerstarted_=!1,this.callendTime_=(new Date).getTime();var e,t=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(t),t=Math.round(t/1e3),h.logger.log("Call Duration "+t),1==this.conferencecall_?this.SendTelemetryData(p.tel_key_ConferenceCallDuration,t,1):(1==this.audiocall_.active&&this.SendTelemetryData(p.tel_key_AudioCallDuration,t,1),1==this.videocall_.active&&this.SendTelemetryData(p.tel_key_VideoCallDuration,t,1),1==this.screensharingcall_.active&&this.SendTelemetryData(p.tel_key_ScreensharingCallDuration,t,1)),1==this.firsttimelocaloffer_&&(e=this.callstartTime_-this.outgoingcallstart_),1==this.firsttimeremoteoffer_&&(e=this.callstartTime_-this.incomingcallstart_),this.MillisecondstoDisplayformat_(e),e=Math.round(e/1e3),h.logger.log("Call Establish Time "+e),1==this.incomingcall_?this.SendTelemetryData(p.tel_key_CallEstIncoming,e,1):1==this.outgoingcall_&&this.SendTelemetryData(p.tel_key_CallEstOutgoing,e,1),this.SendTelemetryData(p.tel_key_PerfCallState,p.tel_CallState.idle,1)}},t.prototype.close=function(){var e=this;h.logger.log(this.user_friendly_id()+".close() called."),this.CalculateCallDurationandType_(),this.unregisterStateChangeNotification(this.onStateChange),this.onaddstream=null,this.onicecandidate=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onsignalingstatechange=null,this.onnegotiationneeded=null,this.waitUntilConnected(this.user_friendly_id()+".close").then((function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.close)})).then((function(){e.iceQ_=null,e.release(),h.logger.log(e.user_friendly_id()+".close() success.")})).catch((function(){e.iceQ_=null,e.release(),h.logger.log(e.user_friendly_id()+".close() failed.")}))},t.prototype.createDTMFSender=function(e){var t;h.logger.log(this.user_friendly_id()+".createDTMFSender() called.");var n=this.senders_;if(void 0!==n&&0!==n.length||(n=this.getSenders()),null!=n){var i=n.find((function(t){return t.track.id===e.id}));null!=i&&(h.logger.log(this.user_friendly_id()+" returning RtpSender with oid:"+i.object_id()),t=i.dtmf)}return t},t.prototype.getSenders=function(){var e=this;return h.logger.log(this.user_friendly_id()+".getSenders() called."),this.waitUntilConnected(this.user_friendly_id()+".getSenders").then((function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getSenders,[])})).then((function(t){var n=[];return t.params[0].forEach((function(t){var i=e.senders_.find((function(e){return e.object_id()===t.oid}));void 0===i?(h.logger.log(e.user_friendly_id()+" adding a RtpSender with oid:"+t.oid),i=new d.RtpSender(e,t.oid,l.ProxyMode.Remote),n.push(i.syncBarrier())):n.push(i)})),Promise.all(n)})).then((function(t){h.logger.log(e.user_friendly_id()+".getSenders: returning senders with ids ["+t.map((function(e){return e.object_id()}))+"]"),e.senders_=t})).catch((function(){h.logger.log(e.user_friendly_id()+".getSenders() didnt get response."),e.senders_=[]})),this.senders_},t.prototype.getReceivers=function(){var e=this;return h.logger.log(this.user_friendly_id()+".getReceivers() called."),this.waitUntilConnected(this.user_friendly_id()+".getReceivers").then((function(){return e.remoteInvoke(!1,g.method_id_RTCPeerConnection_t.getReceivers,[])})).then((function(t){var n=[];return t.params[0].forEach((function(t){var i=e.receivers_.find((function(e){return e.object_id()===t.oid}));void 0===i?(h.logger.log(e.user_friendly_id()+" adding a RtpReceiver with oid:"+t.oid),i=new d.RtpReceiver(e,t.oid),n.push(i.syncBarrier())):n.push(i)})),Promise.all(n)})).then((function(t){h.logger.log(e.user_friendly_id()+".getReceivers: returning receiver with ids ["+t.map((function(e){return e.object_id()}))+"]"),e.receivers_=t})).catch((function(){h.logger.log(e.user_friendly_id()+".getReceivers() didnt get response."),e.receivers_=[]})),this.receivers_},t}(l.ProxyObject);t.PeerConnection=R},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(2),s=n(3),c=n(0);!function(e){e[e.Webrpc=0]="Webrpc",e[e.WebrtcCodecs=1]="WebrtcCodecs",e[e.Receiver=2]="Receiver",e[e.Vda=3]="Vda",e[e.Endpoint=4]="Endpoint",e[e.TypeScript=5]="TypeScript",e[e.Max=6]="Max"}(t.VersionType||(t.VersionType={}));var d=function(e){function t(){return e.call(this,null,o.class_id_t.EngineControl,0,s.ProxyMode.Local)||this}return r(t,e),t.prototype.bind=function(){c.logger.log(this.user_friendly_id()+".bind() called."),this.reconstructor(null,o.class_id_t.EngineControl,0)},t.prototype.syncBarrier=function(){var e=this;return c.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected("EngineControl.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,o.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),e.remoteInvoke(!1,o.method_id_EngineControl_t.feature_flags,[])])})).then((function(t){var n;c.logger.log(e.user_friendly_id()+"received webrpc version and supported feature list."),n=t.map((function(t){return e.param0(t)})),e.version_=n[0],e.features_=n[1],a.getRedirector().setFeatures(e.features_);for(var i=!1,r=!1,s=0,d=e.features_;s<d.length;s++){var l=d[s];"ms_teams_desktop_sharing"===l.name&&!0===l.value?i=!0:"ms_teams_osinfo"===l.name&&!0===l.value&&(r=!0)}return r&&i?Promise.all([e.remoteInvoke(!1,o.method_id_EngineControl_t.version_info,[]),e.remoteInvoke(!1,o.method_id_EngineControl_t.osinfo,{family:"",version:"",architecture:"",distro:"",edition:""})]):i?Promise.all([e.remoteInvoke(!1,o.method_id_EngineControl_t.version_info,[])]):void 0})).then((function(n){var i;void 0===n?c.logger.log(e.user_friendly_id()+"release-1905 client."):n.length>1?(i=n.map((function(t){return e.param0(t)})),e.versions_=i[0],e.osinfo_=i[1]):(c.logger.log(e.user_friendly_id()+"release-1906 or later client: received detailed client version list."),e.versions_=n.map((function(t){return e.param0(t)}))[0]),t(e)})).catch((function(){c.logger.log(e.user_friendly_id()+"failure to retrieve version/feature related client info."),n()}))}))},t}(s.ProxyObject);t.EngineControl=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=function(e){function t(t,n){return e.call(this,t,a.class_id_t.RTCIceCandidate,n,o.ProxyMode.Remote)||this}return r(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected("IceCandidate.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.candidate,""),e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.sdpMid,""),e.remoteInvoke(!1,a.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])})).then((function(n){var i;i=n.map((function(t){return e.param0(t)})),e.candidate_=i[0],e.sdpMid_=i[1],e.sdpMLineIndex_=i[2],t(e)})).catch((function(){n()}))}))},t}(o.ProxyObject);t.IceCandidate=c;var d=function(e){function t(t,n){return e.call(this,t,a.class_id_t.RTCIceCandidatePair,n,o.ProxyMode.Remote)||this}return r(t,e),Object.defineProperty(t.prototype,"local",{get:function(){return this.local_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remote",{get:function(){return this.remote_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return s.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise((function(t,n){e.waitUntilConnected("IceCandidatePair.syncBarrier").then((function(){return Promise.all([e.remoteInvoke(!1,a.method_id_RTCIceCandidatePair_t.local,{}),e.remoteInvoke(!1,a.method_id_RTCIceCandidatePair_t.remote,{})])})).then((function(n){var i;i=n.map((function(t){return e.param0(t)})),e.local_=i[0],e.remote_=i[1],t(e)})).catch((function(){n()}))}))},t}(o.ProxyObject);t.IceCandidatePair=d},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),c=n(1),d=n(0),l=n(8),u=function(e){function t(t,n){var i=e.call(this,t,c.class_id_t.RTCRtpTransceiver,n,s.ProxyMode.Remote)||this;return d.logger.log(i.user_friendly_id()+".constructor"),i.sender_=null,i.receiver_=null,i}return r(t,e),t.prototype.syncBarrier=function(){return o(this,void 0,void 0,(function(){var e,t,n,i,r,o,u,_,g=this;return a(this,(function(a){switch(a.label){case 0:return d.logger.log(this.user_friendly_id()+".syncBarrier() called."),[4,Promise.all([this.remoteInvoke(!1,c.method_id_RTCRtpTransceiver_t.sender,{}),this.remoteInvoke(!1,c.method_id_RTCRtpTransceiver_t.receiver,{})])];case 1:return t=a.sent(),e=t.map((function(e){return g.param0(e)})),n=e[0],i=e[1],null==n||!1!==n.is_null||null!==this.sender_&&this.sender_.object_id()==n.oid?[3,3]:(r=new l.RtpSender(this,n.oid,s.ProxyMode.Remote),o=this,[4,r.syncBarrier().catch((function(){return d.logger.log(g.user_friendly_id()+"sender.syncBarrier(): failed!"),null}))]);case 2:o.sender_=a.sent(),a.label=3;case 3:return null==i||!1!==i.is_null||null!==this.receiver_&&this.receiver_.object_id()==i.oid?[3,5]:(u=new l.RtpReceiver(this,i.oid),_=this,[4,u.syncBarrier().catch((function(){return d.logger.log(g.user_friendly_id()+"receiver.syncBarrier(): failed!"),null}))]);case 4:_.receiver_=a.sent(),a.label=5;case 5:return[2,this]}}))}))},Object.defineProperty(t.prototype,"mid",{get:function(){return this.mid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this.sender_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"receiver",{get:function(){return this.receiver_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this.direction_},set:function(e){var t=this;d.logger.log(this.user_friendly_id()+".se_direction() called."),this.waitUntilConnected("RtpTransceiver.set_direction").then((function(){return t.remoteInvoke(!0,c.method_id_RTCRtpTransceiver_t.direction,t.toRtpDirection(e))})).then((function(){t.direction_=e})).catch((function(){d.logger.log(t.user_friendly_id()+".set_direction: failed.")}))},enumerable:!0,configurable:!0}),t.prototype.stop=function(){var e=this;d.logger.log(this.user_friendly_id()+".stop() called."),this.waitUntilConnected("RtpTransceiver.stop").then((function(){return e.remoteInvoke(!0,c.method_id_RTCRtpTransceiver_t.stop)})).then((function(){d.logger.log(e.user_friendly_id()+".stop: success.")})).catch((function(){d.logger.log(e.user_friendly_id()+".stop: failed.")}))},t.prototype.setCodecPreferences=function(e){var t=this;d.logger.log(this.user_friendly_id()+".setCodecPreferences() called."),this.waitUntilConnected("RtpTransceiver.setCodecPreferences").then((function(){return t.remoteInvoke(!0,c.method_id_RTCRtpTransceiver_t.setCodecPreferences,e)})).then((function(){d.logger.log(t.user_friendly_id()+".setCodecPreferences: success.")})).catch((function(){d.logger.log(t.user_friendly_id()+".setCodecPreferences: failed.")}))},t.prototype.toRTCRtpDirection=function(e){var t="inactive";return 0==e?t="sendrecv":1==e?t="sendonly":2==e?t="recvonly":3==e&&(t="inactive"),t},t.prototype.toRtpDirection=function(e){var t=3;return"sendrecv"==e?t=0:"sendonly"==e?t=1:"recvonly"==e?t=2:"inactive"==e&&(t=3),t},t}(s.ProxyObject);t.RtpTransceiver=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=n(2),d=n(1),l=function(e){this.x=Math.round(e.x),this.y=Math.round(e.y),this.width=Math.round(e.width),this.height=Math.round(e.height)};t.VideoRect=l;var u=function(e){function t(){var t=e.call(this,null,a.class_id_t.VideoElement,0,o.ProxyMode.Local)||this;return t.srcObject_=null,t.sinkId_="",t.videoWidth=0,t.videoHeight=0,t.isLoaded=!1,t.connectionState="disconnected",t.dispose_=!1,t.disposeTimer=null,t}return r(t,e),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;this.waitUntilConnected("VideoElement.sinkId").then((function(){return t.remoteInvoke(!0,a.method_id_VideoElement_t.sinkId,e)})).then((function(){t.sinkId_=e})).catch((function(){s.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!")}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){if(s.logger.log(this.user_friendly_id()+".srcObject: set srcObject... this.srcObject:"+this.srcObject+" obj:"+e),this.srcObject_!==e){!0===this.dispose_&&null!==this.disposeTimer&&(clearTimeout(this.disposeTimer),this.disposeTimer=null,this.dispose_=!1);var t=c.getRedirector().getFeatureValue(d.FEATURE_ms_teams_1911);null!==this.srcObject_&&(null===e&&(this.dispose_=!0,t&&this.disconnect()),t||this.disconnect(),this.isLoaded=!1),this.srcObject_=e,null!==this.srcObject_&&this.connectTo(this.srcObject_)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){s.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onloadedmetadata",{set:function(e){s.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=e},enumerable:!0,configurable:!0}),t.prototype.setupOnVideoFrameChanged=function(){var e=this,t=this.registerCallbacks(!1,!1,a.method_id_VideoElement_t.onvideoframechanged);t.then((function(t){s.logger.log(e.user_friendly_id()+".onvideoframechanged",t.params),e.videoWidth=t.params[0]||0,e.videoHeight=t.params[1]||0,e.isLoaded||(e.isLoaded=!0,e.onloadedmetadata_&&e.onloadedmetadata_())})),this.remoteInvoke(!0,a.method_id_VideoElement_t.onvideoframechanged,t.success)},t.prototype.connectTo=function(e){var t=this;console.log(this.user_friendly_id()+".connectTo: connect media stream with id = "+e.object_id()+", clone_id = "+e.clone_state.clone_id),this.waitUntilConnected("VideoElement.connectTo").then((function(){return t.setupOnVideoFrameChanged(),e.clone_state.synchronize(e)})).then((function(e){var n=t.registerCallbacks(!0,!1,a.method_id_VideoElement_t.connectTo);return Promise.all([t.remoteInvoke(!1,a.method_id_VideoElement_t.connectTo,{oid:e.object_id()},n.success,n.fail),n.prom()])})).then((function(e){s.logger.log(t.user_friendly_id()+".connectTo: remote media stream is connected!"),t.connectionState="connected",t.onconnectionstatechange_&&t.onconnectionstatechange_(),t.updateTimer=setInterval((function(){t.ontimeupdate&&t.ontimeupdate()}),250)})).catch((function(e){s.logger.log(t.user_friendly_id()+".connectTo: failed to connect! msg = ",e)}))},t.prototype.disconnect=function(){var e=this;s.logger.log(this.user_friendly_id()+".disconnect: disconnect from current media stream"),!0===this.dispose_&&(this.disposeTimer=setTimeout((function(){e.release()}),5e3)),this.waitUntilConnected("VideoElement.disconnect").then((function(){e.updateTimer&&clearInterval(e.updateTimer);var t=e.registerCallbacks(!1,!0,a.method_id_VideoElement_t.onvideoframechanged);return e.remoteInvoke(!0,a.method_id_VideoElement_t.onvideoframechanged,t.success),e.remoteInvoke(!1,a.method_id_VideoElement_t.disconnect)})).then((function(){s.logger.log(e.user_friendly_id()+".disconnect: remote media stream is disconnected!"),e.connectionState="disconnected",e.onconnectionstatechange_&&e.onconnectionstatechange_()})).catch((function(){s.logger.log(e.user_friendly_id()+".disconnect: failed to connect!")}))},t.prototype.setFrame=function(e){var t=this;s.logger.log(this.user_friendly_id()+".setFrame: set video frame to",e.x,e.y,e.width,e.height),this.waitUntilConnected("VideoElement.setFrame").then((function(){var n=new l(e);return t.remoteInvoke(!1,a.method_id_VideoElement_t.setFrame,n)})).then((function(){s.logger.log(t.user_friendly_id()+".setFrame: success!")})).catch((function(){s.logger.log(t.user_friendly_id()+".setFrame: failed to connect!")}))},t.prototype.addClipRect=function(e){var t=this;s.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.addClipRect").then((function(){var n=new l(e);return t.remoteInvoke(!1,a.method_id_VideoElement_t.addClipRect,n)})).catch((function(){s.logger.log(t.user_friendly_id()+".addClipRect failed!")}))},t.prototype.removeClipRect=function(e){var t=this;s.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.removeClipRect").then((function(){var n=new l(e);return t.remoteInvoke(!1,a.method_id_VideoElement_t.removeClipRect,n)})).catch((function(){s.logger.log(t.user_friendly_id()+".removeClipRect failed!")}))},t}(o.ProxyObject);t.VideoElement=u},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(0),c=n(2),d=function(e){function t(){var t=e.call(this,null,a.class_id_t.AudioElement,0,o.ProxyMode.Local)||this;return t.sinkId_="",t.srcObject_=null,t}return r(t,e),t.prototype.setSinkId=function(e){var t=this;return s.logger.log(this.user_friendly_id()+".setSinkId: set sinkId to "+e),new Promise((function(n,i){t.waitUntilConnected("AudioElement.sinkId").then((function(){var i=t.remoteInvoke(!0,a.method_id_AudioElement_t.sinkId,e);return c.getRedirector().getFeatureValue(a.FEATURE_ms_teams_pstn)||(t.sinkId_=e,n()),i})).then((function(){t.sinkId_=e,n()})).catch((function(){s.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!"),i()}))}))},t.prototype.sinkId=function(){return this.sinkId_},Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){var t=this;if(s.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(e)),e!==this.srcObject_){var n=e,i=null!=n?n.object_id():"null";this.waitUntilConnected("AudioElement.srcObject").then((function(){return t.remoteInvoke(!0,a.method_id_AudioElement_t.srcObject,i)})).then((function(){t.srcObject_=n,null===n&&t.release()})).catch((function(){s.logger.log(t.user_friendly_id()+".srcObject setter: failed to connect!"),null===n&&t.release()}))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.src_},set:function(e){var t=this;s.logger.log(this.user_friendly_id()+".src: set src to "+e),this.src_=e,this.waitUntilConnected("AudioElement.src").then((function(){t.remoteInvoke(!0,a.method_id_AudioElement_t.src,e)})).catch((function(){s.logger.log(t.user_friendly_id()+".src setter: failed to connect!")}))},enumerable:!0,configurable:!0}),t.prototype.play=function(){var e=this;s.logger.log(this.user_friendly_id()+".play() called."),this.waitUntilConnected("AudioElement.play").then((function(){e.remoteInvoke(!1,a.method_id_AudioElement_t.play,[])})).catch((function(){s.logger.log(e.user_friendly_id()+".play: failed to connect!")}))},t.prototype.pause=function(){var e=this;s.logger.log(this.user_friendly_id()+".pause() called."),this.waitUntilConnected("AudioElement.pause").then((function(){e.remoteInvoke(!1,a.method_id_AudioElement_t.pause,[])})).catch((function(){s.logger.log(e.user_friendly_id()+".pause: failed to connect!")}))},t}(o.ProxyObject);t.AudioElement=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2),o=function(){function e(){var t=this;this.running_=!1,this.elements_=[],this.clipRects=new Set,this.wheelEventHandler=function(e){setTimeout((function(){t.updateAll()}),10)},this.keyupEventHandler=function(e){"Tab"!=e.code&&"ArrowUp"!=e.code&&"ArrowDown"!=e.code&&"ArrowLeft"!=e.code&&"ArrowRight"!=e.code&&"PageUp"!=e.code&&"PageDown"!=e.code&&"Home"!=e.code&&"End"!=e.code||t.updateAll()},e.sendOverlayInfo(),this.observer_=new MutationObserver((function(e){t.updateAll()}))}return e.sendOverlayInfo=function(){var e=window.getWindowHandleAsHex;if(null!=e){var t=r.getRedirector();Promise.all([e(),t.startRedirection(!1,"sendOverlayInfo")]).then((function(e){i.logger.log("FrameTracker.sendOverlayInfo: set window handle: "+e[0]),t.WSSendObject({v:"overlay",command:"window",windowHandle:e[0]})}))}else i.logger.log("FrameTracker.sendOverlayInfo: getWindowHandle method is undefined or null")},e.prototype.rectanglesIntersect=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y},e.prototype.intersectingRect=function(e,t){var n={left:Math.max(e.left,t.left),right:Math.min(e.right,t.right),top:Math.max(e.top,t.top),bottom:Math.min(e.bottom,t.bottom)};return new DOMRect(n.left,n.top,n.right-n.left,n.bottom-n.top)},e.prototype.pedigreeCount=function(e,t){for(var n=0,i=e.parentElement;null!=i&&i!=t;)n++,i=i.parentElement;return{isAncestor:null!=i,pedigree:n}},e.prototype.selectTopmost=function(e,t){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),r=this.intersectingRect(n,i),o={x:r.left+r.width/2,y:r.top+r.height/2},a=document.elementFromPoint(o.x,o.y);if(a==e)return e;if(a==t)return t;var s=this.pedigreeCount(e,a),c=this.pedigreeCount(t,a);if(s.isAncestor&&c.isAncestor){if(s.pedigree<c.pedigree)return e;if(c.pedigree<s.pedigree)return t}else{if(s.isAncestor)return e;if(c.isAncestor)return t}},e.prototype.checkOverlappingVideos=function(e){var t=this,n=e.target.getBoundingClientRect();e.overlaps.forEach((function(t){e.target.remoteVideoElement.removeClipRect(t.rect)})),e.overlaps=[],this.elements_.forEach((function(i){if(i!=e){var r=i.overlaps.map((function(e){return e.element})).indexOf(e.target);if(-1!=r){var o=i.overlaps.splice(r,1)[0];i.target.remoteVideoElement.removeClipRect(o.rect)}var a=i.target.getBoundingClientRect();if(t.rectanglesIntersect(n,a)){var s=t.selectTopmost(e.target,i.target);s==e.target?(i.overlaps.push({element:e.target,rect:n}),i.target.remoteVideoElement.addClipRect(n)):s==i.target&&(e.overlaps.push({element:i.target,rect:a}),e.target.remoteVideoElement.addClipRect(a))}}}))},e.prototype.updateAll=function(){var e=this;this.elements_.forEach((function(t){var n=t.target.getBoundingClientRect();if(void 0!==n){var i=t.clientRect;void 0!==i&&i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height||(t.clientRect=n,t.callback(n),e.checkOverlappingVideos(t))}}))},e.prototype.track=function(e,t){var n=this,r=e.getBoundingClientRect();i.logger.log("Track element frame",e,JSON.stringify(r)),console.log(e),this.elements_.push({target:e,clientRect:void 0,callback:t,overlaps:[]});try{i.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach((function(t){n.applyOcclusion(e,JSON.parse(t))}))}catch(e){i.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+e)}this.running_||(i.logger.log("Start FrameTracker observer..."),this.observer_.observe(document.body,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("wheel",this.wheelEventHandler),window.addEventListener("keyup",this.keyupEventHandler),this.running_=!0),this.updateAll()},e.prototype.untrack=function(e){i.logger.log("Untrack element frame",e);var t=-1;this.elements_.forEach((function(n,i){n.target!==e||(t=i)})),t>=0&&(this.elements_.splice(t,1),0===this.elements_.length&&(i.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect(),window.removeEventListener("wheel",this.wheelEventHandler),window.removeEventListener("keyup",this.keyupEventHandler),this.running_=!1))},e.prototype.applyOcclusion=function(e,t){var n=t,i=e.getBoundingClientRect();this.rectanglesIntersect(n,i)&&void 0!==e.remoteVideoElement&&e.remoteVideoElement.addClipRect(n)},e.prototype.addOcclusion=function(e){var t=this;i.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(e)),i.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.add(JSON.stringify(e)),this.elements_.forEach((function(n){t.applyOcclusion(n.target,e)}))},e.prototype.removeOcclusion=function(e){i.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(e)),i.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.delete(JSON.stringify(e)),this.elements_.forEach((function(t){var n=e;void 0!==t.target.remoteVideoElement&&t.target.remoteVideoElement.removeClipRect(n)}))},e}();t.FrameTracker=o}])}));